# Story 10.13: Color System Updates - Design System Alignment

## Status

**Current Status:** todo

## User Story

As a **developer**,
I want **the color system to match the target design specification**,
So that **the interface has consistent visual hierarchy and brand identity**.

## Story Context

**Existing System Integration:**

- Integrates with: Existing design system (Story 10.1), all navigation components
- Technology: Tailwind CSS, CSS custom properties, shadcn/ui theming
- Follows pattern: Add missing color variants, update component usage
- Touch points: globals.css, tailwind.config.ts, all UI components
- Reference: `docs/design/NAVIGATION_GAP_ANALYSIS.md` - Color System section

**Design Requirements:**

From target design (`main-dashboard-redesign.html:11-40`):

```css
--primary: #2563eb; /* Bright blue */
--primary-hover: #1d4ed8; /* Darker blue for hover */
--primary-light: #dbeafe; /* Light blue background */
--bg-tertiary: #f1f5f9; /* Light gray (3rd tier) */
```

Current system uses HSL-based semantic tokens. Need to add missing variants while maintaining shadcn/ui compatibility.

## Acceptance Criteria

**Functional Requirements:**

1. Add `--primary-hover` color variant for interactive states
2. Add `--primary-light` color variant for active/selected backgrounds
3. Add `--bg-tertiary` color variant for subtle backgrounds
4. Success color matches target (#10B981) instead of current darker shade
5. All color variants support dark mode

**Integration Requirements:**

6. New color variants available as Tailwind utilities
7. Components use new color variants appropriately
8. Active navigation items use `primary-light` background
9. Hover states use `primary-hover` where appropriate
10. No breaking changes to existing component colors

**Quality Requirements:**

11. All colors meet WCAG AA contrast requirements (4.5:1 minimum)
12. Dark mode variants properly adjusted
13. Color transitions smooth (duration: 200ms)
14. Documentation updated with new color tokens

## Tasks / Subtasks

### Phase 1: Color System Audit

- [ ] Task 1: Document current color usage (AC: 10)
  - [ ] Audit `globals.css` color variables
  - [ ] List all HSL color tokens
  - [ ] Identify components using each color
  - [ ] Document color usage patterns
  - [ ] Identify potential conflicts

### Phase 2: Add Missing Color Variants

- [ ] Task 2: Add primary color variants (AC: 1,2,11,12)
  - [ ] Read `styles/globals.css`
  - [ ] Add `--primary-hover` in light mode (HSL: 217 91% 46%)
  - [ ] Add `--primary-light` in light mode (HSL: 214 100% 92%)
  - [ ] Add dark mode variants:
    - `--primary-hover`: Lighter in dark mode
    - `--primary-light`: Darker in dark mode (alpha or different hue)
  - [ ] Test contrast ratios with WCAG checker
  - [ ] Document conversion from hex to HSL

- [ ] Task 3: Add background tertiary variant (AC: 3,11,12)
  - [ ] Add `--bg-tertiary` in light mode (HSL: 214 32% 96%)
  - [ ] Add dark mode variant (darker than bg-secondary)
  - [ ] Test on various background uses
  - [ ] Verify contrast with text colors

- [ ] Task 4: Update success color (AC: 4,11,12)
  - [ ] Update `--success` from current #0E9267 to #10B981
  - [ ] Convert to HSL: 158 64% 52%
  - [ ] Update dark mode variant
  - [ ] Test contrast with foreground
  - [ ] Update all success color usage

### Phase 3: Tailwind Configuration

- [ ] Task 5: Expose new colors in Tailwind (AC: 6)
  - [ ] Read `tailwind.config.ts`
  - [ ] Add `primary-hover` to colors:
    ```ts
    primary: {
      DEFAULT: "hsl(var(--primary))",
      foreground: "hsl(var(--primary-foreground))",
      hover: "hsl(var(--primary-hover))",      // NEW
      light: "hsl(var(--primary-light))",      // NEW
    }
    ```
  - [ ] Add `bg-tertiary`:
    ```ts
    bgTertiary: "hsl(var(--bg-tertiary))",
    ```
  - [ ] Generate Tailwind utilities
  - [ ] Test utility classes work

### Phase 4: Component Updates

- [ ] Task 6: Update Sidebar active states (AC: 8)
  - [ ] Read `components/layout/Sidebar.tsx`
  - [ ] Replace `bg-accent` with `bg-primary-light` for active items
  - [ ] Update text color to `text-primary`
  - [ ] Test active state visibility
  - [ ] Verify collapsed state

- [ ] Task 7: Update button hover states (AC: 9)
  - [ ] Read `components/ui/button.tsx`
  - [ ] Update primary button hover:
    - From: `hover:bg-primary/90`
    - To: `hover:bg-primary-hover`
  - [ ] Test all button variants
  - [ ] Verify dark mode

- [ ] Task 8: Update card and background usage (AC: 3,10)
  - [ ] Identify components using `bg-secondary`
  - [ ] Determine where `bg-tertiary` should be used
  - [ ] Update components for subtle depth
  - [ ] Test visual hierarchy
  - [ ] Verify no breaking changes

### Phase 5: Success Color Updates

- [ ] Task 9: Update success color usage (AC: 4)
  - [ ] Find all `text-success` usage
  - [ ] Find all `bg-success` usage
  - [ ] Verify new color (#10B981) looks correct
  - [ ] Update badges, alerts, status indicators
  - [ ] Test dark mode

### Phase 6: Transition Animations

- [ ] Task 10: Ensure smooth color transitions (AC: 13)
  - [ ] Verify `transition: all 0.2s ease` in globals.css
  - [ ] Test color changes on hover
  - [ ] Test color changes on active states
  - [ ] Check for any jarring transitions
  - [ ] Add transition to new color properties if needed

### Phase 7: Contrast Validation

- [ ] Task 11: Validate WCAG AA compliance (AC: 11)
  - [ ] Test primary-light background with text-primary (> 4.5:1)
  - [ ] Test primary-hover with white text (> 4.5:1)
  - [ ] Test bg-tertiary with text-primary (> 4.5:1)
  - [ ] Test success color with text/background (> 4.5:1)
  - [ ] Use WebAIM Contrast Checker
  - [ ] Document all contrast ratios

### Phase 8: Dark Mode Testing

- [ ] Task 12: Test dark mode thoroughly (AC: 5,12)
  - [ ] Toggle dark mode in browser
  - [ ] Test all new color variants
  - [ ] Verify primary-light is darker in dark mode
  - [ ] Verify primary-hover is lighter in dark mode
  - [ ] Check bg-tertiary provides subtle depth
  - [ ] Test on all navigation components

### Phase 9: Documentation

- [ ] Task 13: Update color system documentation (AC: 14)
  - [ ] Document all color tokens in design system
  - [ ] Create color palette reference
  - [ ] Add usage guidelines (when to use each color)
  - [ ] Document hex → HSL conversions
  - [ ] Add dark mode color mappings
  - [ ] Update component docs with new colors

## Dev Notes

### Implementation Approach

Add missing color variants to existing HSL-based system:

1. Keep shadcn/ui semantic token structure
2. Add new variants as additional tokens
3. Update Tailwind config to expose utilities
4. Update components to use new colors
5. Maintain backward compatibility

### Color Conversion Reference

Target design uses hex colors. Convert to HSL for consistency:

```
Hex → HSL Conversion:

#2563EB (primary) → hsl(217, 91%, 54%) ✅ Already matches
#1D4ED8 (primary-hover) → hsl(217, 91%, 46%)
#DBEAFE (primary-light) → hsl(214, 100%, 92%)
#F1F5F9 (bg-tertiary) → hsl(214, 32%, 96%)
#10B981 (success) → hsl(158, 64%, 52%)
```

### Implementation Details

```css
/* styles/globals.css */
@layer base {
  :root {
    /* Existing primary */
    --primary: 217 91% 54%;
    --primary-foreground: 0 0% 100%;

    /* NEW: Primary variants */
    --primary-hover: 217 91% 46%;
    --primary-light: 214 100% 92%;

    /* Existing backgrounds */
    --background: 0 0% 100%;
    --bg-secondary: 210 40% 98%;

    /* NEW: Tertiary background */
    --bg-tertiary: 214 32% 96%;

    /* Updated success color */
    --success: 158 64% 52%; /* Was: 158 84% 34% */
    --success-foreground: 0 0% 100%;
  }

  .dark {
    /* Dark mode primary variants */
    --primary: 217 91% 60%; /* Slightly lighter in dark */
    --primary-hover: 217 91% 70%; /* Even lighter for hover */
    --primary-light: 217 91% 20%; /* Much darker for backgrounds */

    /* Dark mode backgrounds */
    --background: 222.2 84% 4.9%;
    --bg-secondary: 217.2 32.6% 10%;
    --bg-tertiary: 217.2 32.6% 15%; /* Slightly lighter than secondary */

    /* Dark mode success */
    --success: 158 64% 45%;
  }
}
```

```typescript
// tailwind.config.ts
export default {
  theme: {
    extend: {
      colors: {
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
          hover: "hsl(var(--primary-hover))", // NEW
          light: "hsl(var(--primary-light))", // NEW
        },
        success: {
          DEFAULT: "hsl(var(--success))",
          foreground: "hsl(var(--success-foreground))",
        },
        bgTertiary: "hsl(var(--bg-tertiary))", // NEW
      },
    },
  },
}
```

```typescript
// Usage in components
// Before:
<div className="bg-accent text-accent-foreground">Active</div>

// After:
<div className="bg-primary-light text-primary">Active</div>

// Before:
<Button className="hover:bg-primary/90">Click</Button>

// After:
<Button className="hover:bg-primary-hover">Click</Button>
```

### WCAG AA Contrast Requirements

Minimum contrast ratios:

- Normal text: 4.5:1
- Large text (18pt+): 3:1
- UI components: 3:1

Test all new colors:

- `primary-light` (#DBEAFE) with `text-primary` (#0F172A): ~11:1 ✅
- `primary-hover` (#1D4ED8) with white text: ~8:1 ✅
- `bg-tertiary` (#F1F5F9) with `text-primary` (#0F172A): ~15:1 ✅
- `success` (#10B981) with white text: ~4.6:1 ✅

### Component Color Updates Checklist

Components to update:

- [ ] Sidebar (active states → primary-light)
- [ ] HorizontalNav (active states → primary-light)
- [ ] BottomTabBar (active states → primary-light)
- [ ] Buttons (hover → primary-hover)
- [ ] Cards (subtle backgrounds → bg-tertiary)
- [ ] Badges (success → new success color)
- [ ] Alerts (success → new success color)
- [ ] Status indicators (success → new success color)

### Testing Standards

- Visual regression tests for all components
- Contrast checker for all new colors
- Dark mode toggle testing
- Cross-browser color rendering
- Test on different displays (sRGB, DCI-P3)

## Definition of Done

- [ ] `--primary-hover` color added to globals.css
- [ ] `--primary-light` color added to globals.css
- [ ] `--bg-tertiary` color added to globals.css
- [ ] Success color updated to #10B981
- [ ] All colors have dark mode variants
- [ ] Tailwind config updated with new utilities
- [ ] Sidebar uses primary-light for active states
- [ ] Buttons use primary-hover for hover states
- [ ] Cards use bg-tertiary where appropriate
- [ ] All new colors meet WCAG AA contrast
- [ ] Dark mode tested and working
- [ ] Color transitions smooth (200ms)
- [ ] Documentation updated
- [ ] No breaking changes to existing components
- [ ] Visual regression tests pass
- [ ] Build succeeds with no errors
- [ ] TypeScript compilation passes
- [ ] Code reviewed and approved
- [ ] Story status updated to "Done"

## Risk and Compatibility Check

**Minimal Risk Assessment:**

- **Primary Risk:** Color changes may affect visual consistency
- **Mitigation:** Test all components, maintain backward compatibility
- **Rollback:** Revert globals.css and tailwind.config.ts changes

**Compatibility Verification:**

- [ ] Existing color tokens still work
- [ ] Components using old colors unchanged
- [ ] New colors optional (don't break existing)
- [ ] Dark mode toggle still works
- [ ] No contrast issues introduced
- [ ] Theme switching smooth

## Validation Checklist

**Scope Validation:**

- [x] Story requires careful color system work (0.5-1 day)
- [x] Integration approach is straightforward (add tokens, update usage)
- [x] Follows existing patterns (HSL-based, shadcn/ui)
- [x] No backend changes required

**Clarity Check:**

- [x] Story requirements are clear (specific colors defined)
- [x] Integration points are well-defined (globals.css, tailwind.config)
- [x] Success criteria are testable (contrast checks, visual tests)
- [x] Rollback approach exists (simple revert)

---

## Change Log

| Date         | Version | Description            | Author    |
| ------------ | ------- | ---------------------- | --------- |
| Nov 12, 2025 | 1.0     | Initial story creation | Dev Agent |

---

## Dev Agent Record

_To be populated during implementation_

---

## QA Results

_To be populated after QA review_

---

**Story Status:** Approved
**Estimated Effort:** 0.5-1 day
**Dependencies:** Story 10.1 (Design System), existing navigation components
**Epic:** EPIC-10.2 - Design Alignment with Target Specification
**Created:** November 12, 2025
**Last Updated:** November 12, 2025
