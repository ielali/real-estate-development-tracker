# Story 10.11: Enhanced Sidebar - User Profile & Tools Navigation

## Status

**Current Status:** todo

## User Story

As a **user**,
I want **an enhanced sidebar with my profile and quick access to tools**,
So that **I can see my identity and access settings/help easily**.

## Story Context

**Existing System Integration:**

- Integrates with: Existing Sidebar component (Story 10.3)
- Technology: React, Next.js 15, Framer Motion, lucide-react icons
- Follows pattern: Refactor existing component, add new sections
- Touch points: Sidebar component, auth context, user settings
- Reference: `docs/design/new-navigation-proposals/main-dashboard-redesign.html:95-186`

**Design Requirements:**

From target design:

- Hamburger toggle button in header (☰ icon at top)
- User profile section below header (avatar, name, role)
- Secondary "Tools" navigation section with divider
- Notifications item with badge count
- Settings and Help items
- Move collapse button from bottom to header

## Acceptance Criteria

**Functional Requirements:**

1. Hamburger toggle button in sidebar header (replaces bottom toggle)
2. User profile section displays avatar, name, and role
3. User profile clickable to open dropdown menu
4. Secondary "Tools" navigation section with visual divider
5. Notifications item shows badge count when > 0

**Integration Requirements:**

6. Works with existing sidebar collapse/expand animation
7. User data pulled from auth context
8. Avatar generates from user initials or profile image
9. Tools section includes: Notifications, Settings, Help

**Quality Requirements:**

10. All sections animate smoothly during collapse
11. Tooltips show in collapsed state for all items
12. Icons match target design style (Material Symbols or equivalent)
13. User dropdown menu accessible via keyboard

## Tasks / Subtasks

### Phase 1: Refactor Sidebar Structure

- [ ] Task 1: Restructure Sidebar layout (AC: 1,2,4)
  - [ ] Read existing `components/layout/Sidebar.tsx`
  - [ ] Refactor header section (add hamburger toggle)
  - [ ] Remove bottom toggle button
  - [ ] Add user profile section container
  - [ ] Add secondary navigation section
  - [ ] Add visual divider between sections

### Phase 2: Header Section

- [ ] Task 2: Implement new header with hamburger (AC: 1,6)
  - [ ] Replace ChevronLeft icon with Menu (hamburger) icon
  - [ ] Move toggle button to header (flex justify-between)
  - [ ] Update icon rotation logic (no rotation needed for hamburger)
  - [ ] Adjust header layout: [Logo] [DevTrack] [☰]
  - [ ] Test collapse/expand animation
  - [ ] Update keyboard shortcut tooltip

### Phase 3: User Profile Section

- [ ] Task 3: Create user profile component (AC: 2,7,8)
  - [ ] Add profile section below header with border-b
  - [ ] Create avatar component (circular, 40px)
  - [ ] Fetch user data from auth context
  - [ ] Display user name (font-medium, text-sm)
  - [ ] Display user role (text-xs, text-tertiary)
  - [ ] Generate avatar from initials or image URL
  - [ ] Handle collapsed state (show avatar only)

- [ ] Task 4: Implement user dropdown menu (AC: 3,13)
  - [ ] Make profile section clickable
  - [ ] Create dropdown menu component (using shadcn DropdownMenu)
  - [ ] Add menu items: Profile, Settings, Logout
  - [ ] Position dropdown correctly (side="right" in collapsed)
  - [ ] Add keyboard navigation (Arrow keys, Enter, Escape)
  - [ ] Implement menu actions (navigate or trigger)
  - [ ] Add dividers between menu sections

### Phase 4: Secondary Tools Navigation

- [ ] Task 5: Create Tools navigation section (AC: 4,9)
  - [ ] Add border-top divider above Tools section
  - [ ] Add "TOOLS" label (text-xs, uppercase, text-tertiary)
  - [ ] Hide label in collapsed state
  - [ ] Style similar to main navigation items

- [ ] Task 6: Add Notifications item (AC: 5)
  - [ ] Add Notifications navigation item
  - [ ] Use Bell icon (notifications)
  - [ ] Implement badge component (red, circular)
  - [ ] Display badge count from notifications context
  - [ ] Animate badge on count change (scale animation)
  - [ ] Position badge absolute (top-right of item)
  - [ ] Link to notifications page

- [ ] Task 7: Add Settings and Help items (AC: 9)
  - [ ] Add Settings navigation item (Cog icon)
  - [ ] Link to /settings page
  - [ ] Add Help item (HelpCircle or QuestionMark icon)
  - [ ] Link to help/docs page or open help modal
  - [ ] Test hover states
  - [ ] Add tooltips for collapsed state

### Phase 5: Animation & Polish

- [ ] Task 8: Update animations for new structure (AC: 10,11)
  - [ ] Animate user profile section (fade name/role in collapsed)
  - [ ] Animate Tools section label (fade in expanded)
  - [ ] Ensure badge stays visible in collapsed state
  - [ ] Test all animations at 200ms duration
  - [ ] Verify smooth transitions

### Phase 6: Icon Updates

- [ ] Task 9: Update icons to match design (AC: 12)
  - [ ] Decide: Keep Lucide or switch to Material Symbols
  - [ ] Update hamburger icon (Menu from Lucide)
  - [ ] Update notification icon (Bell)
  - [ ] Update settings icon (Settings or Cog)
  - [ ] Update help icon (HelpCircle)
  - [ ] Ensure consistent icon size (w-5 h-5)
  - [ ] Document icon choices

### Phase 7: Testing & Integration

- [ ] Task 10: Component testing (AC: 6,7,8,10,11,13)
  - [ ] Test sidebar expand/collapse with new structure
  - [ ] Test user profile display (with/without avatar)
  - [ ] Test dropdown menu (mouse and keyboard)
  - [ ] Test notification badge updates
  - [ ] Test tooltips in collapsed state
  - [ ] Test navigation to Settings, Help, Notifications
  - [ ] Verify keyboard shortcuts still work (Cmd/Ctrl + B)

### Phase 8: Documentation

- [ ] Task 11: Update documentation
  - [ ] Update Sidebar component JSDoc
  - [ ] Document new props (user, notificationCount)
  - [ ] Update architecture docs with new structure
  - [ ] Add usage examples
  - [ ] Document dropdown menu behavior

## Dev Notes

### Implementation Approach

Refactor existing Sidebar component to match target design:

1. **Header:** Logo + Brand + Hamburger toggle
2. **User Profile:** Avatar + Name + Role (clickable for menu)
3. **Main Navigation:** Existing items (Dashboard, Projects, etc.)
4. **Tools Navigation:** NEW section with Notifications, Settings, Help

Keep existing functionality:

- Collapse/expand animation
- Tooltips in collapsed state
- Active route highlighting
- Keyboard shortcut (Cmd/Ctrl + B)

### Existing Pattern Reference

Current Sidebar structure:

```
┌─────────────────────────┐
│ Header: Logo + Brand    │
├─────────────────────────┤
│ Main Navigation         │
│ - Home                  │
│ - Projects              │
│ - Portfolio             │
│ - Contacts              │
│ - Vendors               │
│ - Categories            │
├─────────────────────────┤
│ [<] Collapse            │ ← Remove this
└─────────────────────────┘
```

Target structure:

```
┌─────────────────────────┐
│ [Logo] DevTrack  [☰]    │ ← Add hamburger here
├─────────────────────────┤
│ [Avatar] John Doe       │ ← Add user profile
│          PM             │
├─────────────────────────┤
│ Main Navigation         │
│ - Dashboard             │
│ - Projects              │
│ - Costs                 │
│ - Timeline              │
│ - Vendors               │
│ - Documents             │
│ - Reports               │
├─────────────────────────┤
│ TOOLS                   │ ← Add tools section
│ - Notifications (3)     │
│ - Settings              │
│ - Help                  │
└─────────────────────────┘
```

### Key Constraints

- Maintain backward compatibility with existing navigation
- Keep smooth animations (200ms, ease-in-out)
- Preserve keyboard shortcuts
- Don't break mobile navigation
- User profile must gracefully handle missing data

### Implementation Details

```typescript
// components/layout/Sidebar.tsx (refactored)
"use client"

import { Menu, Bell, Settings, HelpCircle } from "lucide-react"
import { useAuth } from "@/components/providers/AuthProvider"
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"

// Secondary navigation items
const TOOLS_NAV_ITEMS: NavItem[] = [
  { href: "/notifications", label: "Notifications", icon: Bell, badge: true },
  { href: "/settings", label: "Settings", icon: Settings },
  { href: "/help", label: "Help", icon: HelpCircle },
]

export function Sidebar() {
  const { user, signOut } = useAuth()
  const { isCollapsed, toggle } = useCollapsedSidebar()
  const notificationCount = 3 // TODO: Get from notifications context

  return (
    <aside className="...">
      {/* Header with Hamburger Toggle */}
      <div className="h-16 px-4 flex items-center justify-between border-b">
        <div className="flex items-center gap-2">
          <Building2 className="w-6 h-6 text-primary" />
          {!isCollapsed && <span className="font-semibold">Real Estate Tracker</span>}
        </div>
        <Button
          variant="ghost"
          size="icon"
          onClick={toggle}
          aria-label={isCollapsed ? "Expand sidebar" : "Collapse sidebar"}
        >
          <Menu className="w-5 h-5" />
        </Button>
      </div>

      {/* User Profile Section */}
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <button className="w-full p-4 border-b hover:bg-accent flex items-center gap-3">
            <Avatar className="w-10 h-10">
              <AvatarImage src={user?.image} />
              <AvatarFallback>
                {user?.name?.split(' ').map(n => n[0]).join('') || 'U'}
              </AvatarFallback>
            </Avatar>
            {!isCollapsed && (
              <div className="text-left">
                <div className="font-medium text-sm">{user?.name || 'User'}</div>
                <div className="text-xs text-muted-foreground">{user?.role || 'Member'}</div>
              </div>
            )}
          </button>
        </DropdownMenuTrigger>
        <DropdownMenuContent side="right" align="start">
          <DropdownMenuLabel>My Account</DropdownMenuLabel>
          <DropdownMenuSeparator />
          <DropdownMenuItem>Profile</DropdownMenuItem>
          <DropdownMenuItem>Settings</DropdownMenuItem>
          <DropdownMenuSeparator />
          <DropdownMenuItem onClick={signOut}>Logout</DropdownMenuItem>
        </DropdownMenuContent>
      </DropdownMenu>

      {/* Main Navigation */}
      <nav className="flex-1 px-2 py-4 space-y-1 overflow-y-auto">
        {/* Existing navigation items */}
      </nav>

      {/* Tools Section */}
      <div className="border-t">
        {!isCollapsed && (
          <div className="px-5 py-2">
            <span className="text-xs font-semibold text-muted-foreground uppercase tracking-wider">
              Tools
            </span>
          </div>
        )}
        <nav className="px-2 py-2 space-y-1">
          {TOOLS_NAV_ITEMS.map((item) => (
            <Tooltip key={item.href}>
              <TooltipTrigger asChild>
                <Link href={item.href} className="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-accent">
                  <item.icon className="w-5 h-5" />
                  {!isCollapsed && <span className="text-sm">{item.label}</span>}
                  {item.badge && notificationCount > 0 && (
                    <span className="ml-auto bg-destructive text-destructive-foreground text-xs px-1.5 py-0.5 rounded-full">
                      {notificationCount}
                    </span>
                  )}
                </Link>
              </TooltipTrigger>
              {isCollapsed && <TooltipContent side="right">{item.label}</TooltipContent>}
            </Tooltip>
          ))}
        </nav>
      </div>
    </aside>
  )
}
```

### User Avatar Generation

```typescript
// utils/avatarUtils.ts
export function getInitials(name: string): string {
  return name
    .split(" ")
    .map((n) => n[0])
    .join("")
    .toUpperCase()
    .slice(0, 2)
}

export function getAvatarUrl(userId: string, name: string): string {
  // Use UI Avatars API for fallback
  return `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=2563EB&color=fff`
}
```

### Testing Standards

- Unit tests for new sections
- Integration tests with auth context
- Test user dropdown menu interactions
- Test notification badge updates
- Accessibility tests (keyboard, ARIA)
- Visual regression tests for collapsed/expanded states

## Definition of Done

- [ ] Hamburger toggle button in header
- [ ] Bottom toggle button removed
- [ ] User profile section displays correctly
- [ ] User avatar generates from name/image
- [ ] User dropdown menu functional
- [ ] Tools navigation section added
- [ ] Notifications item with badge working
- [ ] Settings item navigates correctly
- [ ] Help item functional
- [ ] All animations smooth (200ms)
- [ ] Tooltips work in collapsed state
- [ ] Keyboard shortcuts still work (Cmd/Ctrl + B)
- [ ] Dropdown menu keyboard accessible
- [ ] Component documented (JSDoc)
- [ ] Tests pass (unit, integration, a11y)
- [ ] No regressions in existing functionality
- [ ] Build succeeds with no errors
- [ ] TypeScript compilation passes
- [ ] Code reviewed and approved
- [ ] Story status updated to "Done"

## Risk and Compatibility Check

**Minimal Risk Assessment:**

- **Primary Risk:** Refactoring may break existing sidebar functionality
- **Mitigation:** Maintain existing props/hooks, add new features incrementally
- **Rollback:** Git revert to previous Sidebar version

**Compatibility Verification:**

- [ ] Existing navigation items still work
- [ ] Collapse/expand animation preserved
- [ ] Active route highlighting works
- [ ] Keyboard shortcuts functional
- [ ] Mobile navigation unaffected
- [ ] ContentWrapper margin calculation unchanged
- [ ] No auth errors with missing user data

## Validation Checklist

**Scope Validation:**

- [x] Story requires careful refactoring work (1-2 days)
- [x] Integration approach is straightforward (refactor existing component)
- [x] Follows existing patterns (same animation, tooltip patterns)
- [x] No backend changes required (uses existing auth context)

**Clarity Check:**

- [x] Story requirements are clear (target design provided)
- [x] Integration points are well-defined (auth context, navigation)
- [x] Success criteria are testable (functional tests per AC)
- [x] Rollback approach exists (git revert)

---

## Change Log

| Date         | Version | Description            | Author    |
| ------------ | ------- | ---------------------- | --------- |
| Nov 12, 2025 | 1.0     | Initial story creation | Dev Agent |

---

## Dev Agent Record

_To be populated during implementation_

---

## QA Results

_To be populated after QA review_

---

**Story Status:** Approved
**Estimated Effort:** 1-2 days
**Dependencies:** Story 10.9 complete, Story 10.3 existing Sidebar
**Epic:** EPIC-10.2 - Design Alignment with Target Specification
**Created:** November 12, 2025
**Last Updated:** November 12, 2025
