# Story 10.10: Top Header Bar - Global Search & Actions

## Status

**Current Status:** todo

## User Story

As a **user**,
I want **a global header bar with search and quick actions**,
So that **I can quickly find content and perform common tasks from anywhere**.

## Story Context

**Existing System Integration:**

- Integrates with: Root layout (Story 10.9), existing navigation system
- Technology: React, Next.js 15, Framer Motion, shadcn/ui components
- Follows pattern: Fixed header bar at top of main content area
- Touch points: Root layout, all pages receive header bar automatically
- Reference: `docs/design/new-navigation-proposals/main-dashboard-redesign.html:191-214`

**Design Requirements:**

From target design:

- Fixed header bar (h-16, 64px height)
- Global search bar (left side, max-w-xl)
- Notification button with badge indicator
- Primary CTA button ("New Project" with + icon)
- White background with bottom border
- Responsive behavior (mobile vs desktop)

## Acceptance Criteria

**Functional Requirements:**

1. Global search bar displayed prominently on left side
2. Search input has placeholder text "Search projects, costs, vendors..."
3. Notification button shows badge when unread notifications exist
4. Primary CTA button visible on desktop (context-aware label)
5. Header bar fixed at top of main content area

**Integration Requirements:**

6. Header integrates with root layout without breaking pages
7. Header positioned above existing HorizontalNav on project pages
8. ContentWrapper adjusts for header height (margin-top or padding-top)
9. Mobile behavior: Search collapses/adapts, CTA may hide

**Quality Requirements:**

10. Header maintains consistent height (64px) across all pages
11. Search input accessible via keyboard (focus, tab navigation)
12. Notification badge animates when count changes
13. Component follows design system colors and spacing

## Tasks / Subtasks

### Phase 1: Component Foundation

- [ ] Task 1: Create TopHeaderBar component (AC: 1,2,3,4,5)
  - [ ] Create file: `components/layout/TopHeaderBar.tsx`
  - [ ] Define component props interface
  - [ ] Implement fixed positioning (h-16, z-30)
  - [ ] Add white background and bottom border
  - [ ] Create flex layout (justify-between)
  - [ ] Add horizontal padding (px-6)

### Phase 2: Search Implementation

- [ ] Task 2: Implement global search bar (AC: 1,2,11)
  - [ ] Create search input wrapper (flex-1, max-w-xl)
  - [ ] Add search icon (Material Symbol or Lucide)
  - [ ] Style input: bg-secondary, border, rounded-lg
  - [ ] Add placeholder: "Search projects, costs, vendors..."
  - [ ] Implement focus styles (border-primary, ring)
  - [ ] Add keyboard accessibility (Tab, Escape)
  - [ ] Create search handler (UI only, functionality separate)

### Phase 3: Action Buttons

- [ ] Task 3: Implement notification button (AC: 3,12)
  - [ ] Create notification button (p-2, hover:bg-secondary)
  - [ ] Add bell icon (notifications)
  - [ ] Implement badge component (absolute positioning)
  - [ ] Add badge count display (red dot or number)
  - [ ] Add badge animation (scale, fade)
  - [ ] Connect to notification context/hook
  - [ ] Add click handler (navigate to notifications)

- [ ] Task 4: Implement primary CTA button (AC: 4)
  - [ ] Create primary button (bg-primary, text-white)
  - [ ] Add + icon on left
  - [ ] Make label context-aware (e.g., "New Project", "Add Cost")
  - [ ] Add hover state (bg-primary-hover)
  - [ ] Implement click handler (modal or navigation)
  - [ ] Add keyboard accessibility (Enter, Space)

### Phase 4: Responsive Behavior

- [ ] Task 5: Implement mobile adaptations (AC: 9)
  - [ ] Hide search bar on mobile (< 768px)
  - [ ] Show search icon button instead (opens modal/drawer)
  - [ ] Adjust button sizes for touch (min 48x48px)
  - [ ] Test on various screen sizes
  - [ ] Ensure no horizontal overflow

### Phase 5: Layout Integration

- [ ] Task 6: Integrate with root layout (AC: 6,7,8)
  - [ ] Update `app/layout.tsx` to include TopHeaderBar
  - [ ] Position after Sidebar, before ContentWrapper
  - [ ] Adjust ContentWrapper to account for header height
  - [ ] Test on dashboard page
  - [ ] Test on project detail pages (HorizontalNav below)
  - [ ] Test on pages without nested navigation

### Phase 6: Testing & Polish

- [ ] Task 7: Component testing (AC: 10,11,12,13)
  - [ ] Test search input focus behavior
  - [ ] Test notification badge updates
  - [ ] Test CTA button navigation
  - [ ] Test keyboard accessibility (Tab order)
  - [ ] Test screen reader compatibility
  - [ ] Verify design system colors
  - [ ] Check spacing consistency (4px/8px grid)

### Phase 7: Documentation

- [ ] Task 8: Document component usage
  - [ ] Add JSDoc comments to component
  - [ ] Document props and types
  - [ ] Add usage examples
  - [ ] Document search hook integration (for future)
  - [ ] Update architecture docs

## Dev Notes

### Implementation Approach

Create standalone TopHeaderBar component that receives:

- Current page context (for CTA label)
- Search handler (placeholder for now)
- Notification count (from context)

Component should be:

- Stateless where possible
- Responsive (mobile-first)
- Accessible (ARIA labels, keyboard nav)
- Animated (smooth transitions)

### Existing Pattern Reference

Similar to existing navigation components (Sidebar, HorizontalNav):

- Fixed positioning
- z-index layering (z-30 for header, z-40 for sidebar)
- Framer Motion for animations
- shadcn/ui component patterns

### Key Constraints

- Must not break existing page layouts
- Must work with existing ContentWrapper margin system
- Search functionality (actual search) is separate story
- Notification system integration is separate story
- Keep component simple, focused on UI only

### Implementation Details

```typescript
// components/layout/TopHeaderBar.tsx
"use client"

import { Search, Bell, Plus } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Badge } from "@/components/ui/badge"
import { useViewport } from "@/hooks/useViewport"

interface TopHeaderBarProps {
  notificationCount?: number
  ctaLabel?: string
  ctaAction?: () => void
  onSearchChange?: (query: string) => void
}

export function TopHeaderBar({
  notificationCount = 0,
  ctaLabel = "New Project",
  ctaAction,
  onSearchChange
}: TopHeaderBarProps) {
  const { isMobile } = useViewport()

  return (
    <header className="fixed top-0 right-0 left-0 md:left-64 h-16 bg-background border-b border-border z-30 transition-all duration-200">
      <div className="h-full px-6 flex items-center justify-between gap-4">
        {/* Search Bar - Desktop */}
        {!isMobile && (
          <div className="flex-1 max-w-xl">
            <div className="relative">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground" />
              <Input
                type="search"
                placeholder="Search projects, costs, vendors..."
                className="pl-10 bg-secondary"
                onChange={(e) => onSearchChange?.(e.target.value)}
              />
            </div>
          </div>
        )}

        {/* Search Button - Mobile */}
        {isMobile && (
          <Button variant="ghost" size="icon">
            <Search className="w-5 h-5" />
          </Button>
        )}

        {/* Right Actions */}
        <div className="flex items-center gap-3">
          {/* Notification Button */}
          <Button variant="ghost" size="icon" className="relative">
            <Bell className="w-5 h-5" />
            {notificationCount > 0 && (
              <span className="absolute top-1 right-1 w-2 h-2 bg-destructive rounded-full" />
            )}
          </Button>

          {/* Primary CTA */}
          {!isMobile && (
            <Button onClick={ctaAction} className="gap-2">
              <Plus className="w-4 h-4" />
              {ctaLabel}
            </Button>
          )}
        </div>
      </div>
    </header>
  )
}
```

### Layout Integration

```typescript
// app/layout.tsx
import { TopHeaderBar } from "@/components/layout/TopHeaderBar"
import { Sidebar } from "@/components/layout/Sidebar"
import { ContentWrapper } from "@/components/layout/ContentWrapper"

export default function RootLayout({ children }) {
  return (
    <Providers>
      <Sidebar />
      <TopHeaderBar />

      {/* Adjust ContentWrapper for header height */}
      <ContentWrapper className="pt-16">
        {children}
      </ContentWrapper>

      <BottomTabBar />
      <MobileNavigation />
    </Providers>
  )
}
```

### Responsive Breakpoints

- **Mobile (< 768px):**
  - Hide full search bar
  - Show search icon button
  - Hide CTA button (use FAB instead)
  - Reduce padding

- **Tablet (768px - 1024px):**
  - Show search bar
  - Show CTA button
  - Moderate padding

- **Desktop (> 1024px):**
  - Full search bar (max-w-xl)
  - Full CTA button
  - Standard padding (px-6)

### Testing Standards

- Unit tests for component rendering
- Integration tests with layout
- Accessibility tests (keyboard, screen reader)
- Visual regression tests (Chromatic or Percy)
- Test notification badge updates
- Test responsive behavior

## Definition of Done

- [ ] TopHeaderBar component created and exported
- [ ] Search bar functional (UI only, handler placeholder)
- [ ] Notification button displays badge correctly
- [ ] Primary CTA button navigates/triggers action
- [ ] Component integrated into root layout
- [ ] ContentWrapper adjusted for header height
- [ ] Mobile responsive behavior working
- [ ] Keyboard navigation accessible
- [ ] Screen reader labels correct
- [ ] Design system colors applied
- [ ] 4px/8px spacing grid followed
- [ ] Component documented (JSDoc, usage examples)
- [ ] Tests pass (unit, integration, a11y)
- [ ] No layout breaks on existing pages
- [ ] Build succeeds with no errors
- [ ] TypeScript compilation passes
- [ ] Code reviewed and approved
- [ ] Story status updated to "Done"

## Risk and Compatibility Check

**Minimal Risk Assessment:**

- **Primary Risk:** Header may conflict with existing HorizontalNav on project pages
- **Mitigation:** Ensure proper z-index layering, test on project detail pages
- **Rollback:** Simple - remove TopHeaderBar from layout, revert ContentWrapper

**Compatibility Verification:**

- [ ] Works with existing Sidebar (doesn't overlap)
- [ ] Works with HorizontalNav on project pages (two-tier header)
- [ ] Works with mobile navigation (BottomTabBar, Drawer)
- [ ] ContentWrapper margin calculation correct
- [ ] No z-index conflicts
- [ ] No scroll issues
- [ ] No horizontal overflow on mobile

## Validation Checklist

**Scope Validation:**

- [x] Story requires careful systematic work (1-2 days)
- [x] Integration approach is straightforward (add to layout)
- [x] Follows existing patterns (similar to Sidebar, HorizontalNav)
- [x] No backend changes required

**Clarity Check:**

- [x] Story requirements are clear (target design provided)
- [x] Integration points are well-defined (root layout)
- [x] Success criteria are testable (functional tests per AC)
- [x] Rollback approach exists (simple removal)

---

## Change Log

| Date         | Version | Description            | Author    |
| ------------ | ------- | ---------------------- | --------- |
| Nov 12, 2025 | 1.0     | Initial story creation | Dev Agent |

---

## Dev Agent Record

_To be populated during implementation_

---

## QA Results

_To be populated after QA review_

---

**Story Status:** Approved
**Estimated Effort:** 1-2 days
**Dependencies:** Story 10.9 must be complete (all pages migrated)
**Epic:** EPIC-10.2 - Design Alignment with Target Specification
**Created:** November 12, 2025
**Last Updated:** November 12, 2025
