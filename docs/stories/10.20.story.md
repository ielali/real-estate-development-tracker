# Story 10.20: Contacts Page Enhancement

## Status

**Current Status:** drafted

## User Story

As a **user**,
I want **an organized contacts page with alphabetical navigation, type filtering, and quick contact access**,
So that **I can quickly find and communicate with project stakeholders**.

## Story Context

**Existing System Integration:**

- Integrates with: Contacts data model, existing contacts API
- Technology: Tailwind CSS, React, tRPC API
- Follows pattern: List-based layout with alphabetical grouping
- Touch points: Contacts page (`app/contacts/page.tsx`)
- Reference: `docs/design/epic-10.3-mockups/contacts-page.html`

**Problem Statement:**

The current contacts page may be a simple list without organization, making it difficult to find specific contacts quickly, especially with many stakeholders across different project types (clients, vendors, partners, team members).

**Target Behavior:**

Users should see an organized contacts list grouped alphabetically, with type badges for quick identification, filter buttons to show specific contact types, an alphabet navigation bar for jumping to letters, and direct access to contact methods (email, phone).

## Acceptance Criteria

**Source Mapping:**

- AC 1-2: From mockup design "Header with Import and Add Contact buttons" [Source: docs/design/epic-10.3-mockups/contacts-page.html, lines 25-49]
- AC 3-4: From mockup design "Search and type filter controls" [Source: docs/design/epic-10.3-mockups/contacts-page.html, lines 52-73]
- AC 5-8: From mockup design "Summary stats cards" [Source: docs/design/epic-10.3-mockups/contacts-page.html, lines 75-132]
- AC 9: From mockup design "Alphabetical navigation bar" [Source: docs/design/epic-10.3-mockups/contacts-page.html, lines 134-164]
- AC 10-14: From mockup design "Grouped contacts list" [Source: docs/design/epic-10.3-mockups/contacts-page.html, lines 166-200]
- AC 15-16: From Epic 10.3 "Contact cards with communication methods" [Source: docs/epics/EPIC-10.3-Screen-Design-Improvements.md, lines 256, 262]
- AC 17: From Epic 10.3 "Mobile-optimized contact cards" [Source: docs/epics/EPIC-10.3-Screen-Design-Improvements.md, lines 264]
- AC 18: From accessibility requirements "WCAG AA compliance" [Source: docs/epics/EPIC-10.3-Screen-Design-Improvements.md, lines 410]

**Functional Requirements:**

1. Page header with "Contacts" title and description
2. Import and Add Contact buttons in header
3. Search bar (searches name, company, role)
4. Type filter buttons: All (with count), Client, Vendor, Partner, Team
5. Summary stats row: Total Contacts, Clients, Vendors, Team Members
6. Stats cards with count and colored icons
7. Stats update based on type filter
8. Empty state when no contacts match filters
9. Alphabetical navigation bar (A-Z)
10. Active letters highlighted (contacts exist)
11. Inactive letters grayed out (no contacts)
12. Contacts grouped by first letter
13. Group headers with letter
14. Contact cards with avatar (initials), name, type badge, role/company

**Integration Requirements:**

15. Contact methods displayed: email, phone, location (icons + text)
16. Quick action buttons: email link, phone link (external)
17. Mobile responsive: single column, smaller cards, touch-friendly
18. WCAG AA accessibility: keyboard navigation, screen reader support

## Tasks / Subtasks

### Phase 1: Page Header

- [ ] Task 1: Build page header (AC: 1,2)
  - [ ] Header card (bg-white, border-b)
  - [ ] Title: "Contacts" (text-2xl, font-bold)
  - [ ] Description: "Manage project stakeholders and team members"
  - [ ] Import button (secondary styling, download icon)
  - [ ] Add Contact button (primary styling, plus icon)
  - [ ] Responsive layout (stack on mobile)

### Phase 2: Search and Filter Controls

- [ ] Task 2: Build search bar (AC: 3)
  - [ ] Input with left icon (search icon)
  - [ ] Placeholder: "Search contacts by name, company, or role..."
  - [ ] Debounce input (300ms)
  - [ ] Search across name, company, and role fields
  - [ ] Clear button when text present
  - [ ] Max-width on desktop (max-w-md)

- [ ] Task 3: Build type filter buttons (AC: 4)
  - [ ] Five filter buttons (All, Client, Vendor, Partner, Team)
  - [ ] Show counts in parentheses for each type
  - [ ] Active button styling (bg-blue-100, text-blue-800)
  - [ ] Inactive button styling (bg-gray-100, text-gray-700)
  - [ ] Rounded-full style
  - [ ] Hover effects
  - [ ] Filter contacts by selected type
  - [ ] Update stats and alphabet nav based on filter

### Phase 3: Summary Stats

- [ ] Task 4: Create stat card component (AC: 5,6)
  - [ ] Reusable StatCard component
  - [ ] Props: label, value, icon, iconColor, iconBgColor
  - [ ] Card layout: value left, icon right
  - [ ] Icon in colored circle (w-10 h-10)
  - [ ] Responsive sizing

- [ ] Task 5: Implement stats calculations (AC: 5,6,7)
  - [ ] Total contacts count
  - [ ] Clients count (type === 'client')
  - [ ] Vendors count (type === 'vendor')
  - [ ] Team members count (type === 'team')
  - [ ] Update stats when type filter applied
  - [ ] Update stats when search applied

### Phase 4: Alphabetical Navigation

- [ ] Task 6: Build alphabet navigation bar (AC: 9,10,11)
  - [ ] 26 letter buttons (A-Z)
  - [ ] Calculate which letters have contacts
  - [ ] Active letter styling (text-primary)
  - [ ] Inactive letter styling (text-gray-400)
  - [ ] Hover effects
  - [ ] Click letter to scroll to group
  - [ ] Smooth scrolling
  - [ ] Update active letters when filter changes
  - [ ] Responsive: wrap on small screens

### Phase 5: Contact Card Component

- [ ] Task 7: Build contact avatar (AC: 14)
  - [ ] Circle with initials (w-12 h-12)
  - [ ] Background colors (blue, green, purple, orange based on type)
  - [ ] Text: initials (uppercase, font-semibold)
  - [ ] Fallback to first letter if no last name

- [ ] Task 8: Build type badge (AC: 14)
  - [ ] Badge with color-coded background:
    - Client: bg-green-100, text-green-800
    - Vendor: bg-purple-100, text-purple-800
    - Partner: bg-blue-100, text-blue-800
    - Team: bg-orange-100, text-orange-800
  - [ ] Text: type name (text-xs, font-medium)
  - [ ] Rounded-full styling

- [ ] Task 9: Build contact card content (AC: 14,15)
  - [ ] Name (text-base, font-semibold)
  - [ ] Role and company (text-sm, text-gray-600)
  - [ ] Contact methods row (email, phone, location)
  - [ ] Icons for each method
  - [ ] Links for email (mailto:) and phone (tel:)
  - [ ] Hover state on card (bg-gray-50)
  - [ ] Click card to view full contact details

### Phase 6: Grouped Contacts List

- [ ] Task 10: Implement alphabetical grouping (AC: 12,13)
  - [ ] Group contacts by first letter of last name
  - [ ] Sort contacts alphabetically within groups
  - [ ] Create group components with headers
  - [ ] Group header: letter (uppercase, font-semibold)
  - [ ] Group header background (bg-gray-50)
  - [ ] Border between groups

- [ ] Task 11: Build contacts container (AC: 12,13,14)
  - [ ] Card wrapper (bg-white, rounded-xl, border)
  - [ ] Groups stacked vertically
  - [ ] Contacts divided by borders
  - [ ] Smooth scrolling to groups
  - [ ] ID anchors for each letter group

### Phase 7: Quick Contact Actions

- [ ] Task 12: Build quick action buttons (AC: 15,16)
  - [ ] Email button (mailto: link)
  - [ ] Phone button (tel: link)
  - [ ] Location button (opens map - optional)
  - [ ] Icon-only or icon+text based on space
  - [ ] Hover effects
  - [ ] Stop propagation (don't trigger card click)
  - [ ] Accessible labels

### Phase 8: Interactions

- [ ] Task 13: Implement search functionality (AC: 3)
  - [ ] Search through contact name
  - [ ] Search through company name
  - [ ] Search through role/title
  - [ ] Debounce input (300ms)
  - [ ] Update displayed contacts
  - [ ] Update alphabet nav (hide empty letters)
  - [ ] Show result count
  - [ ] Clear button functionality

- [ ] Task 14: Implement type filtering (AC: 4,7)
  - [ ] Filter by selected type
  - [ ] Combine with search (type AND search)
  - [ ] Update displayed contacts
  - [ ] Update stats to match filtered results
  - [ ] Update alphabet nav
  - [ ] Persist filter in URL params
  - [ ] Show "No contacts found" if empty

- [ ] Task 15: Implement alphabet navigation (AC: 9,10,11)
  - [ ] Click letter scrolls to group
  - [ ] Smooth scroll behavior
  - [ ] Update URL hash (#a, #b, etc.)
  - [ ] Keyboard navigation (Tab, Enter)
  - [ ] Active letter indicator as user scrolls
  - [ ] Hide/disable letters with no contacts

- [ ] Task 16: Implement contact card click (AC: 14)
  - [ ] Click card to navigate to contact detail
  - [ ] Cursor-pointer on hover
  - [ ] Prevent navigation when clicking quick actions
  - [ ] Keyboard navigation (Tab, Enter)
  - [ ] Focus indicator

### Phase 9: Empty States

- [ ] Task 17: Build empty state components (AC: 8)
  - [ ] No contacts at all (new user)
    - "No contacts yet" message
    - "Add your first contact" button
  - [ ] No search results
    - "No contacts match your search" message
    - "Try different keywords" suggestion
    - Clear filters button
  - [ ] No contacts in type
    - "No {type} contacts" message
  - [ ] Centered content with icon

### Phase 10: Loading States

- [ ] Task 18: Build loading skeletons (AC: 14)
  - [ ] Skeleton for stats cards (shimmer effect)
  - [ ] Skeleton for contact cards (shimmer effect)
  - [ ] Show while fetching data
  - [ ] Match list layout
  - [ ] Accessible (aria-busy, aria-live)

### Phase 11: Import/Export

- [ ] Task 19: Implement import functionality (AC: 2)
  - [ ] Import button opens file picker
  - [ ] Accept CSV format
  - [ ] Parse CSV (name, email, phone, company, role, type)
  - [ ] Validate data
  - [ ] Show import preview
  - [ ] Bulk create contacts
  - [ ] Success/error feedback
  - [ ] Loading state during import

- [ ] Task 20: Implement export functionality (optional)
  - [ ] Export all contacts or filtered
  - [ ] Generate CSV file
  - [ ] Download file
  - [ ] Success notification

### Phase 12: Mobile Optimization

- [ ] Task 21: Optimize for mobile (AC: 17)
  - [ ] Single column stats cards on mobile
  - [ ] Stack search and filters vertically
  - [ ] Smaller contact avatars (w-10 h-10)
  - [ ] Wrap contact methods to multiple lines
  - [ ] Touch-friendly button sizes (h-10 minimum)
  - [ ] Alphabet nav: wrap or horizontal scroll
  - [ ] Test on real devices
  - [ ] Swipe gestures for quick actions (optional)

### Phase 13: Accessibility

- [ ] Task 22: Implement accessibility features (AC: 18)
  - [ ] Semantic HTML (address for contact info)
  - [ ] Keyboard navigation (Tab through contacts)
  - [ ] Focus indicators visible
  - [ ] Type badges have text alternatives
  - [ ] Search input has label (visible or aria-label)
  - [ ] Filter buttons have aria-pressed
  - [ ] Alphabet nav buttons have aria-labels
  - [ ] Contact methods have accessible link text
  - [ ] Color not sole indicator (type has text)
  - [ ] Test with screen reader
  - [ ] Skip link to main content

### Phase 14: Data Integration

- [ ] Task 23: Connect to contacts API (AC: 1-18)
  - [ ] Fetch contacts using tRPC
  - [ ] Map API data to card format
  - [ ] Handle loading states
  - [ ] Handle error states
  - [ ] Create contact mutation
  - [ ] Import contacts mutation
  - [ ] Update contact mutation
  - [ ] Delete contact mutation
  - [ ] Invalidate queries on mutations

### Phase 15: Testing & Validation

- [ ] Task 24: Manual testing
  - [ ] Test search with various keywords
  - [ ] Test each type filter
  - [ ] Test alphabet navigation (each letter)
  - [ ] Test contact card click
  - [ ] Test quick action buttons (email, phone)
  - [ ] Test import functionality
  - [ ] Test with 0, 1, 10, 100+ contacts
  - [ ] Test on mobile devices
  - [ ] Test keyboard navigation

- [ ] Task 25: Automated testing
  - [ ] Unit tests for filter logic
  - [ ] Unit tests for search logic
  - [ ] Unit tests for grouping logic
  - [ ] Unit tests for alphabet calculation
  - [ ] Component tests for ContactCard
  - [ ] Integration tests for API calls
  - [ ] Accessibility tests (axe-core)
  - [ ] Visual regression tests

## Dev Notes

### Learnings from Previous Story

**From Story 10.19 (Projects List):**

[Source: stories/10.19.story.md - Dev Notes, lines 420-500]

**Key Takeaways:**

- **Filter/Search Pattern:** Use URL params for persistent filters, combine with local state for immediate UI updates
- **Stat Calculations:** Recalculate stats when filters change to show accurate counts
- **Component Reusability:** StatCard component pattern works well for summary metrics
- **Performance:** Use memoization for expensive operations (grouping, sorting, filtering)
- **Empty States:** Important for good UX, show helpful messages and clear actions

**Integration Notes for Current Story:**

- Contacts page is inside main app layout (has Sidebar, ContentWrapper)
- Use PageContainer pattern with max-w-7xl (standard content width)
- Alphabetical grouping is more complex than simple filtering
- Consider virtualization if many contacts (100+ contacts)
- Email/phone links should open native apps on mobile

### Implementation Approach

**File Structure:**

```
apps/web/src/
├── app/contacts/
│   └── page.tsx                        # Main contacts list page
├── components/contacts/
│   ├── ContactCard.tsx                 # Contact card component
│   ├── ContactsGroup.tsx               # Grouped contacts section
│   ├── ContactsList.tsx                # List container
│   ├── ContactsFilters.tsx             # Search and type filters
│   ├── ContactsStats.tsx               # Stats cards row
│   ├── AlphabetNav.tsx                 # A-Z navigation
│   ├── ContactAvatar.tsx               # Avatar with initials
│   ├── ContactTypeBadge.tsx            # Type badge component
│   ├── ContactCardSkeleton.tsx         # Loading skeleton
│   └── ContactsEmptyState.tsx          # Empty state component
└── lib/
    ├── contact-filters.ts              # Filter, search utilities
    ├── contact-grouping.ts             # Alphabetical grouping
    └── contact-stats.ts                # Stats calculation
```

**Contact Grouping Utility:**

```typescript
// lib/contact-grouping.ts
export function groupContactsAlphabetically(contacts: Contact[]): Record<string, Contact[]> {
  const grouped: Record<string, Contact[]> = {}

  // Initialize all letters
  for (let i = 65; i <= 90; i++) {
    grouped[String.fromCharCode(i)] = []
  }

  // Group contacts by first letter of last name
  contacts.forEach((contact) => {
    const lastName = contact.name.split(" ").pop() || contact.name
    const firstLetter = lastName[0].toUpperCase()

    if (firstLetter >= "A" && firstLetter <= "Z") {
      grouped[firstLetter].push(contact)
    }
  })

  // Sort contacts within each group
  Object.keys(grouped).forEach((letter) => {
    grouped[letter].sort((a, b) => a.name.localeCompare(b.name))
  })

  return grouped
}

export function getActiveLetters(grouped: Record<string, Contact[]>): string[] {
  return Object.keys(grouped).filter((letter) => grouped[letter].length > 0)
}
```

**Contact Card Component:**

```tsx
// components/contacts/ContactCard.tsx
interface ContactCardProps {
  contact: Contact
  onClick: (id: string) => void
}

export function ContactCard({ contact, onClick }: ContactCardProps) {
  const getInitials = (name: string) => {
    const parts = name.split(" ")
    if (parts.length >= 2) {
      return `${parts[0][0]}${parts[parts.length - 1][0]}`.toUpperCase()
    }
    return parts[0].substring(0, 2).toUpperCase()
  }

  const getAvatarColor = (type: ContactType) => {
    const colors = {
      client: "bg-green-100 text-green-700",
      vendor: "bg-purple-100 text-purple-700",
      partner: "bg-blue-100 text-blue-700",
      team: "bg-orange-100 text-orange-700",
    }
    return colors[type] || "bg-gray-100 text-gray-700"
  }

  return (
    <div
      className="px-6 py-4 hover:bg-gray-50 cursor-pointer transition"
      onClick={() => onClick(contact.id)}
      role="button"
      tabIndex={0}
      onKeyDown={(e) => e.key === "Enter" && onClick(contact.id)}
    >
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-4 flex-1">
          {/* Avatar */}
          <div
            className={`w-12 h-12 rounded-full flex items-center justify-center text-lg font-semibold ${getAvatarColor(contact.type)}`}
          >
            {getInitials(contact.name)}
          </div>

          <div className="flex-1">
            {/* Name and Badge */}
            <div className="flex items-center gap-3">
              <h4 className="text-base font-semibold text-gray-900">{contact.name}</h4>
              <ContactTypeBadge type={contact.type} />
            </div>

            {/* Role and Company */}
            <p className="text-sm text-gray-600 mt-0.5">
              {contact.role}, {contact.company}
            </p>

            {/* Contact Methods */}
            <div className="flex items-center gap-4 mt-2">
              {contact.email && (
                <a
                  href={`mailto:${contact.email}`}
                  className="flex items-center gap-1.5 text-sm text-gray-500 hover:text-primary"
                  onClick={(e) => e.stopPropagation()}
                >
                  <MailIcon className="w-4 h-4" />
                  {contact.email}
                </a>
              )}
              {contact.phone && (
                <a
                  href={`tel:${contact.phone}`}
                  className="flex items-center gap-1.5 text-sm text-gray-500 hover:text-primary"
                  onClick={(e) => e.stopPropagation()}
                >
                  <PhoneIcon className="w-4 h-4" />
                  {contact.phone}
                </a>
              )}
              {contact.location && (
                <div className="flex items-center gap-1.5 text-sm text-gray-500">
                  <LocationIcon className="w-4 h-4" />
                  {contact.location}
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  )
}
```

**Alphabet Navigation Component:**

```tsx
// components/contacts/AlphabetNav.tsx
interface AlphabetNavProps {
  activeLetters: string[]
  onLetterClick: (letter: string) => void
}

export function AlphabetNav({ activeLetters, onLetterClick }: AlphabetNavProps) {
  const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("")

  return (
    <div className="bg-white rounded-lg border border-gray-200 p-3 shadow-sm">
      <div className="flex items-center justify-center gap-3 flex-wrap">
        {alphabet.map((letter) => {
          const isActive = activeLetters.includes(letter)

          return (
            <button
              key={letter}
              className={`w-8 h-8 text-sm font-medium rounded transition ${
                isActive
                  ? "text-primary hover:bg-primary-light"
                  : "text-gray-400 hover:text-gray-700 hover:bg-gray-100"
              }`}
              onClick={() => isActive && onLetterClick(letter)}
              disabled={!isActive}
              aria-label={`Jump to contacts starting with ${letter}`}
            >
              {letter}
            </button>
          )
        })}
      </div>
    </div>
  )
}
```

**Contacts Group Component:**

```tsx
// components/contacts/ContactsGroup.tsx
interface ContactsGroupProps {
  letter: string
  contacts: Contact[]
  onContactClick: (id: string) => void
}

export function ContactsGroup({ letter, contacts, onContactClick }: ContactsGroupProps) {
  if (contacts.length === 0) return null

  return (
    <div id={`letter-${letter.toLowerCase()}`} className="border-b border-gray-200">
      {/* Group Header */}
      <div className="px-6 py-3 bg-gray-50">
        <h3 className="text-sm font-semibold text-gray-700 uppercase">{letter}</h3>
      </div>

      {/* Contacts */}
      <div className="divide-y divide-gray-200">
        {contacts.map((contact) => (
          <ContactCard key={contact.id} contact={contact} onClick={onContactClick} />
        ))}
      </div>
    </div>
  )
}
```

**Contact Type Badge:**

```tsx
// components/contacts/ContactTypeBadge.tsx
const typeBadgeStyles = {
  client: "bg-green-100 text-green-800",
  vendor: "bg-purple-100 text-purple-800",
  partner: "bg-blue-100 text-blue-800",
  team: "bg-orange-100 text-orange-800",
}

const typeLabels = {
  client: "Client",
  vendor: "Vendor",
  partner: "Partner",
  team: "Team",
}

export function ContactTypeBadge({ type }: { type: ContactType }) {
  return (
    <span className={`px-2 py-0.5 text-xs font-medium rounded-full ${typeBadgeStyles[type]}`}>
      {typeLabels[type]}
    </span>
  )
}
```

**CSV Import Utility:**

```typescript
// lib/contact-import.ts
export async function parseContactsCSV(file: File): Promise<Contact[]> {
  const text = await file.text()
  const lines = text.split("\n")
  const headers = lines[0].split(",").map((h) => h.trim().toLowerCase())

  const contacts: Contact[] = []

  for (let i = 1; i < lines.length; i++) {
    const values = lines[i].split(",")

    if (values.length !== headers.length) continue

    const contact: Partial<Contact> = {}

    headers.forEach((header, index) => {
      const value = values[index].trim()
      if (header === "name") contact.name = value
      if (header === "email") contact.email = value
      if (header === "phone") contact.phone = value
      if (header === "company") contact.company = value
      if (header === "role") contact.role = value
      if (header === "type") contact.type = value as ContactType
    })

    if (contact.name && contact.email) {
      contacts.push(contact as Contact)
    }
  }

  return contacts
}
```

### Design System Specifications

**Avatar Colors by Type:**

```typescript
const avatarColors = {
  client: "bg-green-100 text-green-700",
  vendor: "bg-purple-100 text-purple-700",
  partner: "bg-blue-100 text-blue-700",
  team: "bg-orange-100 text-orange-700",
}
```

**Type Badge Colors:**

```typescript
const badgeColors = {
  client: "bg-green-100 text-green-800",
  vendor: "bg-purple-100 text-purple-800",
  partner: "bg-blue-100 text-blue-800",
  team: "bg-orange-100 text-orange-800",
}
```

**Stat Card Icons:**

```typescript
const statIcons = {
  total: {
    icon: "UsersIcon",
    bgColor: "bg-blue-100",
    iconColor: "text-blue-600",
  },
  clients: {
    icon: "UserIcon",
    bgColor: "bg-green-100",
    iconColor: "text-green-600",
  },
  vendors: {
    icon: "BuildingIcon",
    bgColor: "bg-purple-100",
    iconColor: "text-purple-600",
  },
  team: {
    icon: "TeamIcon",
    bgColor: "bg-orange-100",
    iconColor: "text-orange-600",
  },
}
```

### Mobile Optimization

**Touch Targets:**

```css
/* Buttons */
h-10:   40px (minimum touch target)
h-12:   48px (comfortable)

/* Contact card: entire row is clickable */
/* Contact method links: at least 44px */
```

**Mobile Adjustments:**

- Stack search and filters vertically
- Smaller avatars (w-10 h-10 instead of w-12 h-12)
- Contact methods wrap to multiple lines
- Alphabet nav: horizontal scroll or wrap
- Single column stats cards

### Accessibility Requirements

**Contact Card Accessibility:**

```tsx
<div
  className="..."
  role="button"
  tabIndex={0}
  onClick={handleClick}
  onKeyDown={(e) => e.key === "Enter" && handleClick()}
  aria-label={`View contact: ${contact.name}`}
>
  <address className="not-italic">{/* Contact info */}</address>
</div>
```

**Alphabet Nav Accessibility:**

```tsx
<button
  aria-label={`Jump to contacts starting with ${letter}`}
  disabled={!hasContacts}
  aria-disabled={!hasContacts}
>
  {letter}
</button>
```

**Contact Method Links:**

```tsx
<a href={`mailto:${email}`} aria-label={`Send email to ${email}`} onClick={handleEmailClick}>
  <MailIcon aria-hidden="true" />
  <span>{email}</span>
</a>
```

### Testing Strategy

**Grouping Tests:**

- Contacts sorted alphabetically within groups
- Groups sorted A-Z
- Contacts with no last name handled correctly
- Special characters in names handled
- Empty groups not rendered

**Filter Tests:**

- Search by name (first, last, full)
- Search by company
- Search by role
- Filter by each type
- Combine search and type filter
- Alphabet nav updates with filters

**Interaction Tests:**

- Click contact navigates to detail
- Click email opens mail client
- Click phone opens dialer
- Alphabet nav scrolls to letter
- Keyboard navigation works
- Focus management correct

### References

**Epic Context:**

[Source: docs/epics/EPIC-10.3-Screen-Design-Improvements.md, lines 233-268 - Story 10.20 description]

- Goal: Redesign contact cards with better organization
- Add contact type badges (color-coded)
- Implement contact grouping (alphabetical)
- Add contact search with autocomplete
- Improve contact detail view
- Add quick contact actions (email, call placeholders)
- Add import/export functionality
- Estimated effort: 2-3 days
- Priority: Medium
- Risk: Low (UI changes only, communication features are placeholders)

**Design Mockup:**

[Source: docs/design/epic-10.3-mockups/contacts-page.html - Complete mockup implementation]

- Header with Import and Add Contact buttons
- Search bar and type filters
- Four summary stats cards
- Alphabetical navigation bar (A-Z)
- Contacts grouped by first letter
- Contact cards with avatars, badges, contact methods
- Hover effects

**Existing Contacts API:**

[Source: apps/web/src/server/api/routers/contacts.ts]

- getContacts endpoint
- Contact data model with necessary fields
- createContact, updateContact, deleteContact mutations

### Project Structure Notes

[Source: docs/architecture/unified-project-structure.md]

**File Locations:**

- **Contacts Page:** `apps/web/src/app/contacts/page.tsx` (MODIFY - complete redesign)
- **Contact Components:** `apps/web/src/components/contacts/*.tsx` (CREATE - 10+ components)
- **Grouping Utils:** `apps/web/src/lib/contact-grouping.ts` (CREATE)
- **Filter Utils:** `apps/web/src/lib/contact-filters.ts` (CREATE)
- **Stats Utils:** `apps/web/src/lib/contact-stats.ts` (CREATE)
- **Import Utils:** `apps/web/src/lib/contact-import.ts` (CREATE)
- **Contacts API:** `apps/web/src/server/api/routers/contacts.ts` (EXISTS - use existing)

**Component Hierarchy:**

```
ContactsPage
├── Header (title + Import + Add Contact buttons)
├── ContactsFilters (search + type filters)
├── ContactsStats (4 stat cards)
├── AlphabetNav (A-Z navigation)
└── ContactsList
    └── ContactsGroup (for each letter)
        └── ContactCard (for each contact)
```

## Definition of Done

- [ ] Page header implemented with Import and Add Contact buttons
- [ ] Search bar working (searches name, company, role)
- [ ] Type filter buttons working (All, Client, Vendor, Partner, Team)
- [ ] Type filter shows counts for each type
- [ ] Active type filter highlighted
- [ ] Four summary stats cards displaying correctly
- [ ] Stats update based on type filter
- [ ] Stats update based on search
- [ ] Alphabetical navigation bar (A-Z) rendering
- [ ] Active letters highlighted (have contacts)
- [ ] Inactive letters grayed out (no contacts)
- [ ] Click letter scrolls to group (smooth scroll)
- [ ] Contacts grouped by first letter of last name
- [ ] Group headers showing letter
- [ ] Contacts sorted alphabetically within groups
- [ ] Contact cards with avatars (initials)
- [ ] Avatar colors based on contact type
- [ ] Type badges color-coded correctly
- [ ] Contact methods displayed (email, phone, location)
- [ ] Email links open mail client (mailto:)
- [ ] Phone links open dialer (tel:)
- [ ] Click contact card navigates to detail
- [ ] Import button opens file picker
- [ ] CSV import functionality working
- [ ] Import validation and error handling
- [ ] Add Contact button navigates to form
- [ ] Mobile responsive (single column, smaller cards)
- [ ] Touch-friendly interactions on mobile
- [ ] Empty state for no contacts
- [ ] Empty state for no search results
- [ ] Loading skeletons during data fetch
- [ ] Error states with user feedback
- [ ] Keyboard navigation working
- [ ] Screen reader accessible (aria-labels, semantic HTML)
- [ ] Color contrast WCAG AA compliant
- [ ] Search debouncing working (300ms)
- [ ] Filters persist in URL params
- [ ] Alphabet nav updates with filter changes
- [ ] Performance acceptable (100+ contacts)
- [ ] Unit tests passing (grouping, filter, search logic)
- [ ] Integration tests passing (API, interactions)
- [ ] Accessibility tests passing (axe-core)
- [ ] Visual regression tests passing
- [ ] Build succeeds with no errors
- [ ] Code reviewed and approved
- [ ] Story status updated to "Done"

## Risk and Compatibility Check

**Risk Assessment:**

- **Primary Risk:** Alphabetical grouping logic could be complex with edge cases
- **Mitigation:** Thorough testing with various name formats, special characters
- **Rollback:** Feature flag to revert to old contacts list if issues

**Compatibility Verification:**

- [ ] Works with existing contacts API
- [ ] Import functionality handles CSV format correctly
- [ ] Email/phone links work on all platforms (iOS, Android, desktop)
- [ ] Performance acceptable with 100+ contacts
- [ ] Grouping works with real data (varied names)
- [ ] No memory leaks from avatar generation
- [ ] Works on all major browsers

## Validation Checklist

**Scope Validation:**

- [x] Story requires contacts page redesign (2-3 days)
- [x] Integration with existing API is straightforward
- [x] Alphabetical grouping adds complexity
- [x] Import functionality is valuable but optional for MVP
- [x] Mobile responsiveness is critical

**Clarity Check:**

- [x] Story requirements are clear (mockup provides reference)
- [x] Integration points are well-defined (contacts API)
- [x] Success criteria are testable (visual, functional, grouping)
- [x] Rollback approach exists (feature flag)

---

## Change Log

| Date         | Version | Description            | Author    |
| ------------ | ------- | ---------------------- | --------- |
| Nov 13, 2025 | 1.0     | Initial story creation | Dev Agent |

---

## Dev Agent Record

**Context Reference:**

- Story Context: To be generated before implementation
- Design Mockup: `docs/design/epic-10.3-mockups/contacts-page.html`

_Implementation notes to be added during development_

---

## QA Results

_To be populated after QA review_

---

**Story Status:** Drafted
**Estimated Effort:** 2-3 days
**Dependencies:** Existing contacts API, Epic 10.3 design system
**Epic:** EPIC-10.3 - Screen Design Improvements - Core Workflows
**Created:** November 13, 2025
**Last Updated:** November 13, 2025

---

## Quick Start Guide

**Fastest implementation approach:**

1. Create grouping utilities (1 hour)
2. Create filter utilities (1 hour)
3. Build stat card component (30 min)
4. Implement stats calculations (1 hour)
5. Build contact type badge component (30 min)
6. Build contact avatar component (30 min)
7. Build contact card component (2 hours)
8. Build alphabet navigation component (2 hours)
9. Build contacts group component (1 hour)
10. Build contacts list layout (1 hour)
11. Build contacts filters component (2 hours)
12. Implement search functionality (1 hour)
13. Implement type filtering (1 hour)
14. Implement alphabet navigation scrolling (1 hour)
15. Implement CSV import (3 hours)
16. Add mobile responsive styles (2 hours)
17. Add accessibility features (2 hours)
18. Integration testing and bug fixes (3 hours)

**Total: ~24 hours (3 days)**
