# Story 10.5: Bottom Tab Bar Navigation - Brownfield Addition

## Status

**Current Status:** Approved

## User Story

As a **mobile user**,
I want **bottom navigation for easy one-handed use**,
So that **I can navigate while holding my device on site**.

## Story Context

**Existing System Integration:**

- Integrates with: Current mobile responsive navigation from Epic 5
- Technology: Next.js 14, React, Tailwind CSS, Lucide icons
- Follows pattern: Mobile-first responsive design patterns already in place
- Touch points: Mobile layout wrapper, main navigation routes, viewport detection

## Acceptance Criteria

**Functional Requirements:**

1. Fixed bottom tab bar with 56px height
2. 5 tabs implemented: Home, Projects, Add (FAB), Costs, Files
3. Center FAB button raised with shadow effect

**Integration Requirements:** 4. Active state with filled icon and primary color (#2563EB) 5. Badge notification support for counts/alerts 6. Integration with existing routing system

**Quality Requirements:** 7. iOS safe area padding automatically applied 8. Android back button navigation properly handled 9. Haptic feedback on tap for iOS devices

## Tasks / Subtasks

### Phase 1: Mobile Detection & Setup

- [ ] Task 1: Implement viewport detection (AC: 1)
  - [ ] Set up mobile viewport detection hook
  - [ ] Configure breakpoint for mobile (< 768px)
  - [ ] Create responsive wrapper component
  - [ ] Test detection across different devices
  - [ ] Ensure SSR compatibility
  - [ ] Handle window resize events

### Phase 2: Bottom Tab Bar Component

- [ ] Task 2: Create bottom tab bar structure (AC: 1,2)
  - [ ] Create BottomTabBar component
  - [ ] Set fixed positioning at bottom
  - [ ] Apply 56px height with flex layout
  - [ ] Add z-index to stay above content
  - [ ] Configure 5 tab items with equal spacing
  - [ ] Ensure full width coverage

### Phase 3: Tab Items Implementation

- [ ] Task 3: Implement individual tab items (AC: 2,3)
  - [ ] Import icons from lucide-react (Home, Briefcase, Plus, DollarSign, FileText)
  - [ ] Create TabItem component with icon and label
  - [ ] Implement standard tab styling
  - [ ] Add touch target sizing (minimum 44px)
  - [ ] Configure tab press animations
  - [ ] Add accessibility labels

### Phase 4: Floating Action Button (FAB)

- [ ] Task 4: Style center FAB button (AC: 3)
  - [ ] Position center tab differently (raised)
  - [ ] Add circular background to Plus icon
  - [ ] Apply primary color background
  - [ ] Add box shadow for elevation
  - [ ] Slightly larger size than other tabs
  - [ ] Implement press animation/scale effect

### Phase 5: Active State & Navigation

- [ ] Task 5: Implement active state logic (AC: 4,6)
  - [ ] Connect to Next.js routing
  - [ ] Detect current route for active state
  - [ ] Apply primary color to active tab
  - [ ] Use filled vs outlined icon variants
  - [ ] Update active state on route change
  - [ ] Ensure smooth state transitions

### Phase 6: Badge Notifications

- [ ] Task 6: Add badge support (AC: 5)
  - [ ] Create Badge component overlay
  - [ ] Position badges on tab icons
  - [ ] Support numeric counts
  - [ ] Support dot indicators
  - [ ] Configure badge colors (red for alerts)
  - [ ] Test with different count values

### Phase 7: iOS Safe Areas

- [ ] Task 7: Handle iOS safe areas (AC: 7)
  - [ ] Add CSS env() variables for safe areas
  - [ ] Apply padding-bottom: env(safe-area-inset-bottom)
  - [ ] Test on iPhone with notch/home indicator
  - [ ] Ensure content doesn't overlap
  - [ ] Handle landscape orientation
  - [ ] Test on iPad if applicable

### Phase 8: Android Integration

- [ ] Task 8: Android-specific handling (AC: 8)
  - [ ] Detect Android device/browser
  - [ ] Handle hardware back button
  - [ ] Integrate with browser history
  - [ ] Test gesture navigation
  - [ ] Ensure proper navigation flow
  - [ ] Handle app switcher scenarios

### Phase 9: Haptic Feedback

- [ ] Task 9: Implement haptic feedback (AC: 9)
  - [ ] Detect iOS Safari/WebKit
  - [ ] Use Vibration API if available
  - [ ] Add subtle haptic on tab press
  - [ ] Make feedback optional (user preference)
  - [ ] Test on physical iOS devices
  - [ ] Graceful degradation for unsupported devices

### Phase 10: Integration & Polish

- [ ] Task 10: Complete integration (AC: All)
  - [ ] Hide desktop navigation on mobile
  - [ ] Show bottom bar only on mobile viewports
  - [ ] Adjust main content padding-bottom
  - [ ] Prevent content from hiding behind tab bar
  - [ ] Test all navigation paths
  - [ ] Verify no duplicate navigation
  - [ ] Add transition animations

### Phase 11: Testing & Documentation

- [ ] Task 11: Comprehensive testing
  - [ ] Test on iOS devices (iPhone SE to Pro Max)
  - [ ] Test on Android devices (various sizes)
  - [ ] Test on tablets (responsive behavior)
  - [ ] Verify routing works correctly
  - [ ] Check performance on low-end devices
  - [ ] Test in different browsers
  - [ ] Document implementation
  - [ ] Update story status

## Dev Notes

### Integration Approach

Add bottom tab bar component for mobile viewports, hide desktop nav. Use CSS media queries and viewport detection to conditionally render.

### Existing Pattern Reference

Use existing responsive utilities and viewport detection patterns from the codebase. Follow mobile-first approach.

### Key Constraints

Must work with existing routing, preserve all navigation paths. Should not interfere with desktop navigation.

### Implementation Details

```typescript
// useViewport hook for mobile detection
import { useEffect, useState } from 'react'

export function useViewport() {
  const [isMobile, setIsMobile] = useState(false)

  useEffect(() => {
    const checkViewport = () => {
      setIsMobile(window.innerWidth < 768)
    }

    checkViewport()
    window.addEventListener('resize', checkViewport)
    return () => window.removeEventListener('resize', checkViewport)
  }, [])

  return { isMobile }
}

// BottomTabBar component
import Link from 'next/link'
import { usePathname } from 'next/navigation'
import { cn } from '@/lib/utils'
import {
  Home,
  Briefcase,
  Plus,
  DollarSign,
  FileText
} from 'lucide-react'

interface TabItem {
  icon: React.ElementType
  label: string
  href: string
  isFloatingAction?: boolean
  badge?: number | boolean
}

const bottomTabs: TabItem[] = [
  { icon: Home, label: 'Home', href: '/' },
  { icon: Briefcase, label: 'Projects', href: '/projects' },
  { icon: Plus, label: 'Add', href: '/add', isFloatingAction: true },
  { icon: DollarSign, label: 'Costs', href: '/costs' },
  { icon: FileText, label: 'Files', href: '/documents' }
]

export function BottomTabBar() {
  const pathname = usePathname()

  return (
    <nav className={cn(
      "fixed bottom-0 left-0 right-0",
      "h-14 pb-[env(safe-area-inset-bottom)]",
      "bg-background border-t",
      "flex items-center justify-around",
      "md:hidden" // only show on mobile
    )}>
      {bottomTabs.map((tab) => {
        const Icon = tab.icon
        const isActive = pathname === tab.href

        if (tab.isFloatingAction) {
          return (
            <Link
              key={tab.label}
              href={tab.href}
              className="relative -top-2"
            >
              <div className={cn(
                "w-14 h-14 rounded-full",
                "bg-primary text-primary-foreground",
                "flex items-center justify-center",
                "shadow-lg hover:shadow-xl",
                "transition-all duration-200",
                "active:scale-95"
              )}>
                <Icon className="w-6 h-6" />
              </div>
            </Link>
          )
        }

        return (
          <Link
            key={tab.label}
            href={tab.href}
            className={cn(
              "flex flex-col items-center justify-center",
              "flex-1 h-full relative",
              "transition-colors duration-200",
              isActive
                ? "text-primary"
                : "text-muted-foreground"
            )}
            onClick={() => {
              // Haptic feedback for iOS
              if ('vibrate' in navigator) {
                navigator.vibrate(10)
              }
            }}
          >
            <div className="relative">
              <Icon
                className="w-6 h-6"
                fill={isActive ? 'currentColor' : 'none'}
              />
              {tab.badge && (
                <span className={cn(
                  "absolute -top-1 -right-1",
                  "min-w-[18px] h-[18px]",
                  "bg-red-500 text-white",
                  "text-xs rounded-full",
                  "flex items-center justify-center",
                  "px-1"
                )}>
                  {typeof tab.badge === 'number' ? tab.badge : ''}
                </span>
              )}
            </div>
            <span className="text-[10px] mt-1">
              {tab.label}
            </span>
          </Link>
        )
      })}
    </nav>
  )
}

// Layout adjustment for content
export function MobileLayout({ children }: { children: React.ReactNode }) {
  const { isMobile } = useViewport()

  return (
    <div className={cn(
      "min-h-screen",
      isMobile && "pb-14" // add padding for tab bar
    )}>
      {children}
      {isMobile && <BottomTabBar />}
    </div>
  )
}

// CSS for safe areas (in globals.css)
.pb-safe {
  padding-bottom: env(safe-area-inset-bottom);
}

/* Support for iOS PWA */
@supports (padding-bottom: env(safe-area-inset-bottom)) {
  .bottom-tab-bar {
    padding-bottom: calc(1rem + env(safe-area-inset-bottom));
  }
}
```

### Component Files to Modify/Create

- `components/navigation/bottom-tab-bar.tsx` - New bottom tab component
- `components/layout/mobile-layout.tsx` - Mobile layout wrapper
- `hooks/use-viewport.ts` - Viewport detection hook
- `app/layout.tsx` - Add mobile layout wrapper
- `app/globals.css` - Safe area styles

### Testing Standards

- Test on real iOS devices (iPhone 12 Pro, SE)
- Test on real Android devices (Pixel, Samsung)
- Use Chrome DevTools device emulation
- Test safe areas with iPhone simulator
- Verify haptic feedback on physical devices
- Test navigation flow thoroughly

## Definition of Done

- [ ] Bottom tab bar displays on mobile devices only
- [ ] All 5 tabs functional with correct routing
- [ ] Center FAB button styled with elevation
- [ ] Active states working correctly
- [ ] Badge notifications displaying properly
- [ ] iOS safe areas respected
- [ ] Android back navigation handled
- [ ] Haptic feedback on iOS (if supported)
- [ ] Main content doesn't hide behind tab bar
- [ ] Desktop experience unchanged
- [ ] All routes remain accessible
- [ ] Performance acceptable on low-end devices
- [ ] Cross-browser compatibility verified
- [ ] PR created with device screenshots
- [ ] Code reviewed and approved
- [ ] Story status updated to "Done"

## Risk and Compatibility Check

**Minimal Risk Assessment:**

- **Primary Risk:** Conflicting with existing mobile navigation or viewport issues
- **Mitigation:** Progressive enhancement - only show on mobile, fallback to current nav
- **Rollback:** CSS class to hide bottom bar, revert to existing mobile menu

**Compatibility Verification:**

- [ ] No breaking changes to desktop experience
- [ ] All routes remain accessible
- [ ] Existing mobile menu can coexist
- [ ] Performance impact minimal on mobile

## Validation Checklist

**Scope Validation:**

- [x] Story can be completed in one development session (4 hours)
- [x] Integration approach is straightforward (new mobile component)
- [x] Follows existing responsive patterns
- [x] No backend changes required

**Clarity Check:**

- [x] Story requirements are unambiguous
- [x] Integration points are clearly specified (mobile layout)
- [x] Success criteria are testable (device testing)
- [x] Rollback approach is simple (hide component)

---

## Change Log

| Date         | Version | Description                                        | Author       |
| ------------ | ------- | -------------------------------------------------- | ------------ |
| Nov 2024     | 1.0     | Initial story creation from Epic 10                | Product Team |
| Nov 10, 2024 | 1.1     | Added comprehensive Tasks/Subtasks section         | Sarah (PO)   |
| Nov 10, 2024 | 1.2     | Added missing template sections and implementation | Sarah (PO)   |
| Nov 10, 2024 | 1.3     | Story approved for development                     | Sarah (PO)   |

---

## Dev Agent Record

### Agent Model Used

_To be populated during implementation_

### Debug Log References

_To be populated during implementation_

### Completion Notes List

_To be populated during implementation_

### File List

**New files to be created:**

- `components/navigation/bottom-tab-bar.tsx`
- `components/layout/mobile-layout.tsx`
- `hooks/use-viewport.ts`

**Expected files to be modified:**

- `app/layout.tsx`
- `app/globals.css`

_Additional files to be documented during implementation_

---

## QA Results

_To be populated after QA review_

---

**Story Status:** Approved
**Estimated Effort:** 4 hours
**Dependencies:** Stories 10.1 & 10.2 (design system)
**Feature Flag:** Not required (progressive enhancement)
**Epic:** EPIC-10 - Modern Navigation & Design System Overhaul
**Created:** November 2024
**Last Updated:** November 10, 2024
