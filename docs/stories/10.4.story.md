# Story 10.4: Horizontal Top Navigation for Subsections - Brownfield Addition

## Status

**Current Status:** Approved

## User Story

As a **user viewing project details**,
I want **horizontal navigation instead of tabs**,
So that **I have more vertical space for content**.

## Story Context

**Existing System Integration:**

- Integrates with: Current tab components in project detail pages from Epic 1-5
- Technology: Next.js 14, TypeScript, Shadcn/ui Tabs component, React Router
- Follows pattern: Existing tab navigation pattern but with horizontal menu layout
- Touch points: Project detail page, all subsection components (costs, timeline, documents, contacts)

## Acceptance Criteria

**Functional Requirements:**

1. Replace existing vertical tabs with horizontal menu bar
2. Save 40px vertical space compared to current tab implementation
3. Icons paired with text labels for each section

**Integration Requirements:** 4. All existing project subsections remain accessible 5. Active state indicated with bottom border (2px solid primary) 6. Sticky positioning maintained on scroll

**Quality Requirements:** 7. Smooth transitions (200ms) between sections 8. All existing data and functionality preserved in each section 9. Mobile responsive with horizontal scroll if needed

## Tasks / Subtasks

### Phase 1: Current Implementation Analysis

- [ ] Task 1: Analyze existing tab implementation (AC: 4,8)
  - [ ] Locate current tab component in project detail pages
  - [ ] Document existing navigation structure
  - [ ] Map all subsection routes and components
  - [ ] Measure current vertical space usage
  - [ ] Review data loading patterns for each section
  - [ ] Identify any tab-specific logic to preserve

### Phase 2: Navigation Component Design

- [ ] Task 2: Create horizontal navigation component (AC: 1,3)
  - [ ] Create new HorizontalNav component
  - [ ] Define navigation items array with labels and icons
  - [ ] Import appropriate icons from lucide-react
  - [ ] Structure nav as flex container with horizontal layout
  - [ ] Add responsive wrapper for mobile
  - [ ] Ensure component is reusable across pages

### Phase 3: Visual Implementation

- [ ] Task 3: Implement navigation styling (AC: 2,5)
  - [ ] Apply horizontal flex layout with appropriate spacing
  - [ ] Set navigation height to save 40px vs tabs
  - [ ] Style navigation items with padding and hover states
  - [ ] Implement active state with 2px bottom border
  - [ ] Use primary color for active indicator
  - [ ] Add focus states for accessibility
  - [ ] Ensure consistent icon and text sizing

### Phase 4: Sticky Positioning

- [ ] Task 4: Implement sticky navigation behavior (AC: 6)
  - [ ] Add sticky positioning CSS to nav container
  - [ ] Set appropriate top offset (0 or header height)
  - [ ] Configure z-index to stay above content
  - [ ] Add background color to prevent content bleed
  - [ ] Add subtle shadow or border for depth
  - [ ] Test scroll behavior across different content lengths

### Phase 5: Routing Integration

- [ ] Task 5: Connect navigation to routing system (AC: 4,7)
  - [ ] Use Next.js Link components for navigation items
  - [ ] Maintain existing URL structure for subsections
  - [ ] Implement active route detection
  - [ ] Add route change animations (200ms transitions)
  - [ ] Preserve query parameters if any
  - [ ] Ensure browser back/forward works correctly

### Phase 6: Section Content Integration

- [ ] Task 6: Replace tabs with new navigation (AC: 1,4,8)
  - [ ] Remove old Tabs component from project detail page
  - [ ] Insert HorizontalNav component
  - [ ] Update page layout to accommodate new nav
  - [ ] Verify each section component still loads
  - [ ] Test data fetching for each subsection
  - [ ] Ensure no functionality is lost
  - [ ] Verify forms and interactions work

### Phase 7: Mobile Optimization

- [ ] Task 7: Implement mobile responsive design (AC: 9)
  - [ ] Add horizontal scroll wrapper for mobile
  - [ ] Implement scroll indicators if needed
  - [ ] Consider condensed labels on small screens
  - [ ] Test touch interactions
  - [ ] Ensure active state is visible when scrolled
  - [ ] Add scroll snap points if appropriate
  - [ ] Test on various mobile devices

### Phase 8: Space Optimization Verification

- [ ] Task 8: Validate space savings (AC: 2)
  - [ ] Measure new navigation height
  - [ ] Compare with original tab height
  - [ ] Confirm 40px vertical space saved
  - [ ] Document measurements in PR
  - [ ] Take before/after screenshots
  - [ ] Verify content area increased appropriately

### Phase 9: Testing & Polish

- [ ] Task 9: Comprehensive testing (AC: All)
  - [ ] Test navigation between all sections
  - [ ] Verify data loads correctly in each section
  - [ ] Test sticky behavior on scroll
  - [ ] Validate active state updates
  - [ ] Check transition animations (200ms)
  - [ ] Test keyboard navigation (Tab, Enter)
  - [ ] Verify accessibility with screen reader
  - [ ] Cross-browser testing
  - [ ] Mobile device testing
  - [ ] Performance testing (no janky scrolling)

### Phase 10: Documentation & Cleanup

- [ ] Task 10: Complete implementation
  - [ ] Document component API and usage
  - [ ] Add JSDoc comments to component
  - [ ] Update story status to "Done"
  - [ ] Create implementation notes
  - [ ] Remove old tab component imports
  - [ ] Clean up any unused styles
  - [ ] Update Dev Agent Record

## Dev Notes

### Integration Approach

Replace Tabs component with custom horizontal nav using existing routing. The new component should be a drop-in replacement that maintains all current functionality while providing better space efficiency.

### Existing Pattern Reference

Maintain current URL-based routing for subsections. Each project subsection should continue to have its own route.

### Key Constraints

Must preserve all existing section functionality and data loading. No changes to backend APIs or data structures.

### Implementation Details

```typescript
// HorizontalNav component structure
import { usePathname } from 'next/navigation'
import Link from 'next/link'
import { cn } from '@/lib/utils'
import {
  Home,
  DollarSign,
  Calendar,
  FileText,
  Users
} from 'lucide-react'

interface NavItem {
  label: string
  icon: React.ElementType
  href: string
}

const projectNavItems: NavItem[] = [
  { label: 'Overview', icon: Home, href: '/projects/[id]' },
  { label: 'Costs', icon: DollarSign, href: '/projects/[id]/costs' },
  { label: 'Timeline', icon: Calendar, href: '/projects/[id]/timeline' },
  { label: 'Documents', icon: FileText, href: '/projects/[id]/documents' },
  { label: 'Contacts', icon: Users, href: '/projects/[id]/contacts' }
]

export function HorizontalNav({ projectId }: { projectId: string }) {
  const pathname = usePathname()

  return (
    <nav className="sticky top-0 z-10 bg-background border-b">
      <div className="flex items-center space-x-1 px-4 overflow-x-auto">
        {projectNavItems.map((item) => {
          const href = item.href.replace('[id]', projectId)
          const isActive = pathname === href
          const Icon = item.icon

          return (
            <Link
              key={item.label}
              href={href}
              className={cn(
                "flex items-center gap-2 px-4 py-3 text-sm font-medium",
                "border-b-2 transition-all duration-200",
                "hover:text-foreground hover:bg-accent/50",
                isActive
                  ? "border-primary text-foreground"
                  : "border-transparent text-muted-foreground"
              )}
            >
              <Icon className="h-4 w-4" />
              <span>{item.label}</span>
            </Link>
          )
        })}
      </div>
    </nav>
  )
}

// Usage in project detail layout
<div className="flex flex-col h-full">
  <HorizontalNav projectId={params.id} />
  <main className="flex-1 overflow-auto">
    {children}
  </main>
</div>

// Mobile responsive styles
@media (max-width: 640px) {
  .nav-scroll-container {
    overflow-x: auto;
    scrollbar-width: thin;
    -webkit-overflow-scrolling: touch;
  }

  .nav-scroll-container::-webkit-scrollbar {
    height: 4px;
  }
}
```

### Component Files to Modify

- `app/projects/[id]/layout.tsx` - Replace tabs with horizontal nav
- `components/navigation/horizontal-nav.tsx` - New component (create)
- `app/projects/[id]/page.tsx` - Overview section
- `app/projects/[id]/costs/page.tsx` - Costs section
- `app/projects/[id]/timeline/page.tsx` - Timeline section
- `app/projects/[id]/documents/page.tsx` - Documents section
- `app/projects/[id]/contacts/page.tsx` - Contacts section

### Testing Standards

- Measure vertical space: Use browser DevTools to compare heights
- Test sticky behavior: Scroll through long content
- Mobile testing: Test on actual devices and responsive mode
- Performance: Monitor scroll performance in DevTools
- Accessibility: Use axe DevTools and keyboard navigation

## Definition of Done

- [ ] Horizontal navigation implemented on project detail pages
- [ ] 40px vertical space saved (measured and documented)
- [ ] Icons and labels displayed correctly
- [ ] Active state with 2px bottom border indicator working
- [ ] Sticky positioning functional on scroll
- [ ] All sections load data correctly
- [ ] Mobile responsive with horizontal scroll
- [ ] 200ms transitions between sections
- [ ] No regression in functionality
- [ ] Keyboard navigation working
- [ ] Cross-browser compatibility verified
- [ ] PR created with before/after screenshots
- [ ] Code reviewed and approved
- [ ] Story status updated to "Done"

## Risk and Compatibility Check

**Minimal Risk Assessment:**

- **Primary Risk:** Breaking existing section routing or data loading
- **Mitigation:** Maintain exact same routing structure, only change visual presentation
- **Rollback:** Simple component swap back to tabs

**Compatibility Verification:**

- [ ] No breaking changes to section URLs
- [ ] Database queries unchanged
- [ ] All section functionality preserved
- [ ] Performance maintained or improved

## Validation Checklist

**Scope Validation:**

- [x] Story can be completed in one development session (3-4 hours)
- [x] Integration approach is straightforward (UI component replacement)
- [x] Follows existing routing patterns exactly
- [x] No backend changes required

**Clarity Check:**

- [x] Story requirements are unambiguous
- [x] Integration points are clearly specified (project detail pages)
- [x] Success criteria are testable (space savings measurable)
- [x] Rollback approach is simple (component swap)

---

## Change Log

| Date         | Version | Description                                | Author       |
| ------------ | ------- | ------------------------------------------ | ------------ |
| Nov 2024     | 1.0     | Initial story creation from Epic 10        | Product Team |
| Nov 10, 2024 | 1.1     | Added comprehensive Tasks/Subtasks section | Sarah (PO)   |
| Nov 10, 2024 | 1.2     | Added missing template sections            | Sarah (PO)   |
| Nov 10, 2024 | 1.3     | Story approved for development             | Sarah (PO)   |

---

## Dev Agent Record

### Agent Model Used

_To be populated during implementation_

### Debug Log References

_To be populated during implementation_

### Completion Notes List

_To be populated during implementation_

### File List

**Expected files to be modified:**

- `app/projects/[id]/layout.tsx`
- `app/projects/[id]/page.tsx`
- `app/projects/[id]/costs/page.tsx`
- `app/projects/[id]/timeline/page.tsx`
- `app/projects/[id]/documents/page.tsx`
- `app/projects/[id]/contacts/page.tsx`

**New files to be created:**

- `components/navigation/horizontal-nav.tsx`

_Additional files to be documented during implementation_

---

## QA Results

_To be populated after QA review_

---

**Story Status:** Approved
**Estimated Effort:** 3-4 hours
**Dependencies:** Stories 10.1 & 10.2 (design system)
**Feature Flag:** Not required (progressive enhancement)
**Epic:** EPIC-10 - Modern Navigation & Design System Overhaul
**Created:** November 2024
**Last Updated:** November 10, 2024
