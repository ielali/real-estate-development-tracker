# Story 10.7: Floating Action Button with Speed Dial - Brownfield Addition

## Status

**Current Status:** Approved

## User Story

As a **mobile user**,
I want **quick access to add content**,
So that **I can capture information quickly on site**.

## Story Context

**Existing System Integration:**

- Integrates with: Existing add/create workflows from Epics 1-5 (projects, costs, documents, etc.)
- Technology: Next.js 14, React, Framer Motion, existing form components
- Follows pattern: Current modal/form patterns for creating new items
- Touch points: Bottom tab bar (Story 10.5), all create/add actions, camera permissions

## Acceptance Criteria

**Functional Requirements:**

1. FAB centered in bottom tab bar with elevated styling
2. Tap reveals speed dial menu with 5 options: Photo, Cost, Task, Document, Note
3. Each option triggers existing create workflows

**Integration Requirements:** 4. Integrates with bottom tab bar from Story 10.5 5. Speed dial options route to existing forms/modals 6. Camera permission handling for photo option

**Quality Requirements:** 7. Staggered animation for menu items (50ms delay between each) 8. Backdrop overlay when speed dial is open 9. Smooth spring animations for open/close

## Tasks / Subtasks

### Phase 1: Preparation & Analysis

- [ ] Task 1: Analyze existing create workflows (AC: 3,5)
  - [ ] Review all create/add forms from Epics 1-5
  - [ ] Document photo capture workflow and camera permissions
  - [ ] Document cost entry form and validation
  - [ ] Document task creation form
  - [ ] Document document upload workflow
  - [ ] Document note creation form
  - [ ] Map routing paths for each create action

### Phase 2: FAB Component Setup

- [ ] Task 2: Create FAB base component (AC: 1,4)
  - [ ] Create `FloatingActionButton.tsx` component
  - [ ] Integrate with bottom tab bar from Story 10.5
  - [ ] Position FAB in center of tab bar (absolute positioning)
  - [ ] Implement elevated styling (shadow-lg, elevation-3)
  - [ ] Size FAB at 56x56px (Material Design standard)
  - [ ] Add primary color background with proper contrast
  - [ ] Test FAB renders correctly in tab bar
  - [ ] Ensure FAB doesn't overlap tab items

### Phase 3: Speed Dial Menu Structure

- [ ] Task 3: Create speed dial menu component (AC: 2)
  - [ ] Create `SpeedDialMenu.tsx` component
  - [ ] Define 5 menu options (Photo, Cost, Task, Document, Note)
  - [ ] Import appropriate icons (Camera, DollarSign, CheckSquare, FileText, StickyNote)
  - [ ] Position menu above FAB with proper spacing
  - [ ] Implement vertical stack layout for menu items
  - [ ] Add labels for each option
  - [ ] Style menu items with proper sizing (48x48px touch target)
  - [ ] Ensure menu is accessible and keyboard navigable

### Phase 4: Animation Implementation

- [ ] Task 4: Implement staggered animations (AC: 7,9)
  - [ ] Set up Framer Motion variants for menu items
  - [ ] Implement staggered appearance (50ms delay between items)
  - [ ] Add scale and opacity transitions (0 to 1)
  - [ ] Configure spring animation for smooth motion
  - [ ] Add rotation animation to FAB icon (0deg to 45deg)
  - [ ] Test animation smoothness at 60fps
  - [ ] Optimize animation performance on low-end devices
  - [ ] Add reduced motion support for accessibility

### Phase 5: Backdrop Overlay

- [ ] Task 5: Implement backdrop overlay (AC: 8)
  - [ ] Create backdrop component with semi-transparent background
  - [ ] Set backdrop opacity (typically 50-60%)
  - [ ] Add click handler to close speed dial
  - [ ] Animate backdrop fade in/out with menu
  - [ ] Ensure proper z-index layering (below menu, above content)
  - [ ] Test backdrop covers entire viewport
  - [ ] Prevent body scroll when speed dial is open

### Phase 6: Photo Capture Integration

- [ ] Task 6: Integrate photo capture workflow (AC: 3,6)
  - [ ] Import existing photo capture component/workflow
  - [ ] Implement camera permission request handling
  - [ ] Handle permission denied state gracefully
  - [ ] Test camera opens on Photo option tap
  - [ ] Verify photo capture flow works end-to-end
  - [ ] Test on iOS Safari and Android Chrome
  - [ ] Handle file upload after photo capture
  - [ ] Add error handling for camera failures

### Phase 7: Form Workflow Integration

- [ ] Task 7: Connect remaining create workflows (AC: 3,5)
  - [ ] Integrate cost entry form modal
  - [ ] Integrate task creation form modal
  - [ ] Integrate document upload workflow
  - [ ] Integrate note creation form modal
  - [ ] Ensure all forms open correctly from speed dial
  - [ ] Verify form validation works as expected
  - [ ] Test form submission flows
  - [ ] Ensure speed dial closes after action selection

### Phase 8: State Management

- [ ] Task 8: Implement speed dial state management (AC: 2,3)
  - [ ] Create state for speed dial open/closed
  - [ ] Implement toggle function for FAB tap
  - [ ] Handle outside click to close
  - [ ] Handle Escape key to close
  - [ ] Close speed dial after option selection
  - [ ] Persist FAB visibility across navigation
  - [ ] Handle speed dial state during page transitions

### Phase 9: Accessibility & Keyboard Support

- [ ] Task 9: Implement accessibility features
  - [ ] Add proper ARIA labels to FAB and menu items
  - [ ] Implement keyboard navigation (Tab, Arrow keys)
  - [ ] Add focus trap when speed dial is open
  - [ ] Ensure Escape key closes speed dial
  - [ ] Add screen reader announcements
  - [ ] Test with VoiceOver on iOS
  - [ ] Test with TalkBack on Android
  - [ ] Verify touch target sizes meet accessibility guidelines (48x48px minimum)

### Phase 10: Testing & Refinement

- [ ] Task 10: Comprehensive testing (AC: 1-9)
  - [ ] Test FAB positioning in tab bar on various screen sizes
  - [ ] Test all 5 speed dial options trigger correct workflows
  - [ ] Test staggered animation timing and smoothness
  - [ ] Test camera permissions on iOS and Android
  - [ ] Test all form submissions from speed dial
  - [ ] Test backdrop overlay and click-to-close
  - [ ] Verify 60fps animations on low-end devices
  - [ ] Test with existing bottom tab navigation (Story 10.5)
  - [ ] Test landscape and portrait orientations

- [ ] Task 11: Documentation and completion
  - [ ] Document FAB component usage
  - [ ] Document how to add new speed dial options
  - [ ] Create usage examples for developers
  - [ ] Update story status to "Done"
  - [ ] Update Dev Agent Record with completion notes
  - [ ] Create demo video or GIF for PR

## Dev Notes

### Integration Approach

Enhance center tab from Story 10.5 with speed dial menu functionality. Use Framer Motion for staggered animations and connect to existing create workflows.

### Existing Pattern Reference

Use existing modal/form components for each action. Follow current photo capture and form validation patterns from Epics 1-5.

### Key Constraints

- Must work with existing create workflows without modification
- Maintain existing form validation and submission logic
- FAB must integrate seamlessly with bottom tab bar from Story 10.5
- Camera permissions must be handled gracefully across platforms

### Implementation Details

```typescript
// Speed dial configuration
const speedDialOptions = [
  { icon: Camera, label: "Photo", action: "capture-photo", route: "/capture-photo" },
  { icon: DollarSign, label: "Cost", action: "add-cost", modal: "CostEntryModal" },
  { icon: CheckSquare, label: "Task", action: "add-task", modal: "TaskCreateModal" },
  { icon: FileText, label: "Document", action: "upload-document", route: "/upload-document" },
  { icon: StickyNote, label: "Note", action: "add-note", modal: "NoteCreateModal" },
]

// Staggered animation variants
const containerVariants = {
  open: {
    transition: { staggerChildren: 0.05, delayChildren: 0.05 },
  },
  closed: {
    transition: { staggerChildren: 0.05, staggerDirection: -1 },
  },
}

const itemVariants = {
  hidden: { scale: 0, opacity: 0, y: 20 },
  visible: {
    scale: 1,
    opacity: 1,
    y: 0,
    transition: { type: "spring", stiffness: 400, damping: 25 },
  },
}

// FAB component structure
const fabClassName = cn(
  "absolute -top-6 left-1/2 -translate-x-1/2",
  "w-14 h-14 rounded-full",
  "bg-primary text-primary-foreground",
  "shadow-lg elevation-3",
  "flex items-center justify-center",
  "transition-transform duration-200",
  "active:scale-95"
)

// Speed dial menu positioning
const menuClassName = cn(
  "absolute bottom-full mb-4 left-1/2 -translate-x-1/2",
  "flex flex-col gap-3",
  "pb-2"
)

// Backdrop overlay
const backdropClassName = cn("fixed inset-0 bg-black/50 z-40", "backdrop-blur-sm")

// Camera permission handling
const requestCameraPermission = async () => {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true })
    stream.getTracks().forEach((track) => track.stop())
    return true
  } catch (error) {
    console.error("Camera permission denied:", error)
    return false
  }
}
```

### Testing Standards

- Test on iOS Safari and Android Chrome
- Verify 60fps animations with React DevTools Profiler
- Test camera permissions on physical devices
- Test all form workflows end-to-end
- Manual testing required for gesture and animation feel
- Test files location: `__tests__/components/navigation/SpeedDial.test.tsx`
- Use Lighthouse for accessibility audits

## Definition of Done

- [ ] FAB displays in center of bottom tab bar with elevated styling
- [ ] Speed dial menu opens on tap with smooth animation
- [ ] All 5 options display with staggered animation (50ms delay)
- [ ] Photo option requests camera permission and opens camera
- [ ] Cost option opens cost entry form
- [ ] Task option opens task creation form
- [ ] Document option opens document upload workflow
- [ ] Note option opens note creation form
- [ ] Each option triggers correct existing workflow
- [ ] Backdrop closes menu when tapped
- [ ] Escape key closes menu
- [ ] Animations smooth at 60fps
- [ ] Screen reader accessible
- [ ] Keyboard navigation works
- [ ] Code follows existing patterns
- [ ] Tests pass
- [ ] PR created with demo
- [ ] Code reviewed and approved
- [ ] Story status updated to "Done"

## Risk and Compatibility Check

**Minimal Risk Assessment:**

- **Primary Risk:** Breaking existing create workflows or permission issues with camera
- **Mitigation:** Use existing form components unchanged, proper permission handling with fallbacks
- **Rollback:** FAB can fallback to simple add button without speed dial

**Compatibility Verification:**

- [ ] All existing create forms still work unchanged
- [ ] No changes to form validation or submission logic
- [ ] Camera permissions handled gracefully on all platforms
- [ ] Works on all mobile devices and browsers
- [ ] No interference with bottom tab navigation
- [ ] Performance smooth on low-end devices

## Validation Checklist

**Scope Validation:**

- [x] Story can be completed in one development session (3-4 hours)
- [x] Integration approach is straightforward (enhance FAB from 10.5)
- [x] Follows existing form/modal patterns
- [x] No backend changes required

**Clarity Check:**

- [x] Story requirements are unambiguous
- [x] Integration points are clearly specified (FAB, existing forms)
- [x] Success criteria are testable (interaction testing)
- [x] Rollback approach is simple (disable speed dial)

---

## Change Log

| Date         | Version | Description                                   | Author       |
| ------------ | ------- | --------------------------------------------- | ------------ |
| Nov 2024     | 1.0     | Initial story creation from Epic 10           | Product Team |
| Nov 10, 2024 | 1.1     | Added Tasks/Subtasks and all missing sections | Product Team |
| Nov 10, 2024 | 1.2     | Story approved for development                | Product Team |

---

## Dev Agent Record

### Agent Model Used

_To be populated during implementation_

### Debug Log References

_To be populated during implementation_

### Completion Notes List

_To be populated during implementation_

### File List

**Expected files to be modified/created:**

- `components/navigation/FloatingActionButton.tsx` (new)
- `components/navigation/SpeedDialMenu.tsx` (new)
- `components/navigation/SpeedDialItem.tsx` (new)
- `components/layout/BottomTabBar.tsx` (modified - from Story 10.5)
- `hooks/useCameraPermission.ts` (new, optional)
- `types/speed-dial.ts` (new, optional)

_Additional files to be documented during implementation_

---

## QA Results

_To be populated after QA review_

---

**Story Status:** Approved
**Estimated Effort:** 3-4 hours
**Dependencies:** Story 10.5 (requires bottom tab bar with FAB)
**Feature Flag:** speed_dial_enabled
**Epic:** EPIC-10 - Modern Navigation & Design System Overhaul
**Created:** November 2024
**Last Updated:** November 10, 2024
